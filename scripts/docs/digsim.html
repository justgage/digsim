<!DOCTYPE html>

<html>
<head>
  <title>digsim.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="component.html">
                component.js
              </a>
            
              
              <a class="source" href="componentList.html">
                componentList.js
              </a>
            
              
              <a class="source" href="digsim.html">
                digsim.js
              </a>
            
              
              <a class="source" href="and-gate.html">
                and-gate.js
              </a>
            
              
              <a class="source" href="ascii-display.html">
                ascii-display.js
              </a>
            
              
              <a class="source" href="clock.html">
                clock.js
              </a>
            
              
              <a class="source" href="dff.html">
                dff.js
              </a>
            
              
              <a class="source" href="jkff.html">
                jkff.js
              </a>
            
              
              <a class="source" href="led.html">
                led.js
              </a>
            
              
              <a class="source" href="mux.html">
                mux.js
              </a>
            
              
              <a class="source" href="nand-gate.html">
                nand-gate.js
              </a>
            
              
              <a class="source" href="nor-gate.html">
                nor-gate.js
              </a>
            
              
              <a class="source" href="not-gate.html">
                not-gate.js
              </a>
            
              
              <a class="source" href="or-gate.html">
                or-gate.js
              </a>
            
              
              <a class="source" href="prom.html">
                prom.js
              </a>
            
              
              <a class="source" href="switch.html">
                switch.js
              </a>
            
              
              <a class="source" href="wire.html">
                wire.js
              </a>
            
              
              <a class="source" href="xor-gate.html">
                xor-gate.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>digsim.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*****************************************************************************
 * Program:
 *  application.js
 *
 * Authors:
 *  Steven Lambert
 *  Zack Sheffield
 *
 * Summary:
 *  A fully functional digital circuit simulation program.
 ****************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * DIGSIM
 *  Holds all the constants, animation, and data variables for the program
 * @constructor
 ****************************************************************************/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Digsim</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Constants</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.GRID_ZOOM         = <span class="hljs-number">5</span>;                     <span class="hljs-comment">// Added or subtracted to gridSize when zooming</span>
    <span class="hljs-keyword">this</span>.MAX_GRID_SIZE     = <span class="hljs-number">40</span>;                    <span class="hljs-comment">// Max zoom level</span>
    <span class="hljs-keyword">this</span>.MIN_GRID_SIZE     = <span class="hljs-number">10</span>;                    <span class="hljs-comment">// Min zoom level</span>
    <span class="hljs-keyword">this</span>.NUM_COLS          = <span class="hljs-number">200</span>;                   <span class="hljs-comment">// Number of columns in the application</span>
    <span class="hljs-keyword">this</span>.NUM_ROWS          = <span class="hljs-number">200</span>;                   <span class="hljs-comment">// Number of rows in the application</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Type identifiers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.AND               = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.NAND              = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.OR                = <span class="hljs-number">3</span>;
    <span class="hljs-keyword">this</span>.NOR               = <span class="hljs-number">4</span>;
    <span class="hljs-keyword">this</span>.XOR               = <span class="hljs-number">5</span>;
    <span class="hljs-keyword">this</span>.NOT               = <span class="hljs-number">6</span>;
    <span class="hljs-keyword">this</span>.DFF               = <span class="hljs-number">7</span>;
    <span class="hljs-keyword">this</span>.JKFF              = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">this</span>.MUX               = <span class="hljs-number">9</span>;
    <span class="hljs-keyword">this</span>.PROM              = <span class="hljs-number">10</span>;
    <span class="hljs-keyword">this</span>.CLOCK             = <span class="hljs-number">11</span>;
    <span class="hljs-keyword">this</span>.WIRE              = <span class="hljs-number">12</span>;
    <span class="hljs-keyword">this</span>.SWITCH            = <span class="hljs-number">13</span>;
    <span class="hljs-keyword">this</span>.LED               = <span class="hljs-number">14</span>;
    <span class="hljs-keyword">this</span>.ASCIIDISPLAY      = <span class="hljs-number">15</span>;

    <span class="hljs-keyword">this</span>.DEFAULT_MODE      = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Default application mode</span>
    <span class="hljs-keyword">this</span>.WIRE_MODE         = <span class="hljs-number">1</span>;                     <span class="hljs-comment">// Placing wires</span>
    <span class="hljs-keyword">this</span>.SIM_MODE          = <span class="hljs-number">2</span>;                     <span class="hljs-comment">// Simulation</span>
    <span class="hljs-keyword">this</span>.PLACE_MODE        = <span class="hljs-number">3</span>;                     <span class="hljs-comment">// Placing Components</span>
    <span class="hljs-keyword">this</span>.EDIT_MODE         = <span class="hljs-number">4</span>;                     <span class="hljs-comment">// Editing Component properties</span>

    <span class="hljs-keyword">this</span>.WARNING           = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Orange(ish) warning messages - simulation will still run</span>
    <span class="hljs-keyword">this</span>.ERROR             = <span class="hljs-number">1</span>;                     <span class="hljs-comment">// Red error messages - will not simulate</span>

    <span class="hljs-keyword">this</span>.TL                = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Top, bottom, left, right selection of wires in grids</span>
    <span class="hljs-keyword">this</span>.TR                = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.BR                = <span class="hljs-number">2</span>;
    <span class="hljs-keyword">this</span>.BL                = <span class="hljs-number">3</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Animation variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.dragging          = <span class="hljs-literal">false</span>;                 <span class="hljs-comment">// Know when a component is being dragged</span>
    <span class="hljs-keyword">this</span>.clkCnt            = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Will count to digsim.CLK_FREQ before it resets and changes states</span>
    <span class="hljs-keyword">this</span>.rotation          = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Rotation of the currently selected Component (in degrees)</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Grid variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.gridSize          = <span class="hljs-number">20</span>;                    <span class="hljs-comment">// The size (in pixels) of a grid square</span>
    <span class="hljs-keyword">this</span>.gridWidth         = window.innerWidth - $(<span class="hljs-string">'.canvases'</span>).position().left;
    <span class="hljs-keyword">this</span>.gridHeight        = window.innerHeight - $(<span class="hljs-string">'.canvases'</span>).position().top;
    <span class="hljs-keyword">this</span>.mousePos          = { x: -<span class="hljs-number">1</span>, y: -<span class="hljs-number">1</span> };      <span class="hljs-comment">// Current position of the mouse on the Canvas</span>
    <span class="hljs-keyword">this</span>.dragStart         = {<span class="hljs-string">'row'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'col'</span>: <span class="hljs-number">0</span>};  <span class="hljs-comment">// Keep track of the row/col of a click to know when we should drag</span>
    <span class="hljs-keyword">this</span>.dragOffset        = {<span class="hljs-string">'row'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'col'</span>: <span class="hljs-number">0</span>};  <span class="hljs-comment">// Keep track of how far from the top-left corner the a click is for dragging</span>
    <span class="hljs-keyword">this</span>.wireStart         = {<span class="hljs-string">'row'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'col'</span>: <span class="hljs-number">0</span>};  <span class="hljs-comment">// Keep track of where a wire starts for wire placement</span>
    <span class="hljs-keyword">this</span>.gridToggle        = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Toggles the grid (tri-state)</span>
    <span class="hljs-keyword">this</span>.hitRadius         = <span class="hljs-number">0.733</span>;                 <span class="hljs-comment">// The size (as a percent) around a wire that will respond to a click</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Gate identifier</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.iComp             = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Gives each component a unique identifier</span>
    <span class="hljs-keyword">this</span>.numGateInputs     = <span class="hljs-number">2</span>;                     <span class="hljs-comment">// Number of inputs - attached to the user interface selection</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Misc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.clipboard         = <span class="hljs-literal">undefined</span>;             <span class="hljs-comment">// Used for cut/copy/paste</span>
    <span class="hljs-keyword">this</span>.selectedComponent = <span class="hljs-literal">undefined</span>;             <span class="hljs-comment">// The currently selected Component</span>
    <span class="hljs-keyword">this</span>.mode              = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// The current mode</span>
    <span class="hljs-keyword">this</span>.connectionStarts  = {};                    <span class="hljs-comment">// Absolute row/col of a connection for wire routing</span>
    <span class="hljs-keyword">this</span>.connectionTargets = {};                    <span class="hljs-comment">// Relative row/col of the Component for wire routing</span>
    <span class="hljs-keyword">this</span>.maxSchematicLoop  = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Prevent infinite loops (such as NOT gate looped back on itself)</span>
    <span class="hljs-keyword">this</span>.passCounter       = <span class="hljs-number">0</span>;                     <span class="hljs-comment">// Counter used to prevent infinite loops</span>
    <span class="hljs-keyword">this</span>.endRoute          = <span class="hljs-literal">false</span>;                 <span class="hljs-comment">// Know when to stop wire routing</span>
    <span class="hljs-keyword">this</span>.mouseDown         = <span class="hljs-literal">false</span>;                 <span class="hljs-comment">// Know if the mouse is currently held down for dragging</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Data arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.components        = <span class="hljs-keyword">new</span> ComponentList();   <span class="hljs-comment">// Holds all placed Components</span>
    <span class="hljs-keyword">this</span>.drivers           = [];                    <span class="hljs-comment">// Holds the id of the logic drivers</span>
    <span class="hljs-keyword">this</span>.placeholders      = [];                    <span class="hljs-comment">// Holds Component positions on grid</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.NUM_COLS; ++i) {
        <span class="hljs-keyword">this</span>.placeholders[i] = [];                  <span class="hljs-comment">// Set placeholder to a 2D array</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Key codes and hot keys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.KEY_CODES          = {                     <span class="hljs-comment">// Key code to button HTML ID dictionary.</span>
        <span class="hljs-number">27</span>    : <span class="hljs-string">'esc'</span>,                              <span class="hljs-comment">// 's' and 'c' refer to a 'shift' and 'ctrl' respectively.</span>
        <span class="hljs-string">'s65'</span> : <span class="hljs-string">'NAND'</span>,
        <span class="hljs-string">'s82'</span> : <span class="hljs-string">'NOR'</span>,
        <span class="hljs-number">65</span>    : <span class="hljs-string">'AND'</span>,
        <span class="hljs-number">69</span>    : <span class="hljs-string">'LED'</span>,
        <span class="hljs-number">84</span>    : <span class="hljs-string">'NOT'</span>,
        <span class="hljs-number">82</span>    : <span class="hljs-string">'OR'</span>,
        <span class="hljs-number">83</span>    : <span class="hljs-string">'Switch'</span>,
        <span class="hljs-number">85</span>    : <span class="hljs-string">'Run'</span>,
        <span class="hljs-number">87</span>    : <span class="hljs-string">'Wire'</span>,
        <span class="hljs-number">88</span>    : <span class="hljs-string">'XOR'</span>,
        <span class="hljs-number">71</span>    : <span class="hljs-string">'Toggle_Grid'</span>,
        <span class="hljs-number">90</span>    : <span class="hljs-string">'Zoom_In'</span>,
        <span class="hljs-string">'s90'</span> : <span class="hljs-string">'Zoom_Out'</span>,
        <span class="hljs-number">46</span>    : <span class="hljs-string">'Delete'</span>,
        <span class="hljs-number">8</span>     : <span class="hljs-string">'Delete'</span>,
        <span class="hljs-string">'c88'</span> : <span class="hljs-string">'Cut'</span>,
        <span class="hljs-string">'c67'</span> : <span class="hljs-string">'Copy'</span>,
        <span class="hljs-string">'c86'</span> : <span class="hljs-string">'Paste'</span>,
        <span class="hljs-number">50</span>    : <span class="hljs-string">'2-input'</span>,
        <span class="hljs-number">51</span>    : <span class="hljs-string">'3-input'</span>,
        <span class="hljs-number">52</span>    : <span class="hljs-string">'4-input'</span>,
        <span class="hljs-number">67</span>    : <span class="hljs-string">'Clock'</span>,
        <span class="hljs-number">9</span>     : <span class="hljs-string">'Rotate_CW'</span>,
        <span class="hljs-string">'s9'</span>  : <span class="hljs-string">'Rotate_CCW'</span>,
        <span class="hljs-number">68</span>    : <span class="hljs-string">'DFF'</span>,
        <span class="hljs-number">77</span>    : <span class="hljs-string">'MUX'</span>

    };
    <span class="hljs-keyword">this</span>.HOT_KEYS           = {                     <span class="hljs-comment">// The hot key text to show for each button (by button HTML ID)</span>
        <span class="hljs-string">'AND'</span>         : <span class="hljs-string">'A'</span>,
        <span class="hljs-string">'OR'</span>          : <span class="hljs-string">'R'</span>,
        <span class="hljs-string">'NOT'</span>         : <span class="hljs-string">'T'</span>,
        <span class="hljs-string">'NAND'</span>        : <span class="hljs-string">'shift+A'</span>,
        <span class="hljs-string">'NOR'</span>         : <span class="hljs-string">'shift+R'</span>,
        <span class="hljs-string">'XOR'</span>         : <span class="hljs-string">'X'</span>,
        <span class="hljs-string">'Switch'</span>      : <span class="hljs-string">'S'</span>,
        <span class="hljs-string">'LED'</span>         : <span class="hljs-string">'E'</span>,
        <span class="hljs-string">'Wire'</span>        : <span class="hljs-string">'W'</span>,
        <span class="hljs-string">'Run'</span>         : <span class="hljs-string">'U'</span>,
        <span class="hljs-string">'Toggle_Grid'</span> : <span class="hljs-string">'G'</span>,
        <span class="hljs-string">'Zoom_In'</span>     : <span class="hljs-string">'Z'</span>,
        <span class="hljs-string">'Zoom_Out'</span>    : <span class="hljs-string">'shift+Z'</span>,
        <span class="hljs-string">'Delete'</span>      : <span class="hljs-string">'del'</span>,
        <span class="hljs-string">'Cut'</span>         : <span class="hljs-string">'ctrl+X'</span>,
        <span class="hljs-string">'Copy'</span>        : <span class="hljs-string">'ctrl+C'</span>,
        <span class="hljs-string">'Paste'</span>       : <span class="hljs-string">'ctrl+V'</span>,
        <span class="hljs-string">'2-input'</span>     : <span class="hljs-string">'2'</span>,
        <span class="hljs-string">'3-input'</span>     : <span class="hljs-string">'3'</span>,
        <span class="hljs-string">'4-input'</span>     : <span class="hljs-string">'4'</span>,
        <span class="hljs-string">'Clock'</span>       : <span class="hljs-string">'C'</span>,
        <span class="hljs-string">'Rotate_CW'</span>   : <span class="hljs-string">'Tab'</span>,
        <span class="hljs-string">'Rotate_CCW'</span>  : <span class="hljs-string">'shift+Tab'</span>,
        <span class="hljs-string">'DFF'</span>         : <span class="hljs-string">'D'</span>,
        <span class="hljs-string">'MUX'</span>         : <span class="hljs-string">'M'</span>
    };
}

<span class="hljs-comment">/*****************************************************************************
 * INIT
 *  Tests to see if the canvas is supported, returning true if it is.
 ****************************************************************************/</span>
Digsim.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Get the canvas element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.gridCanvas              = document.getElementById(<span class="hljs-string">'grid'</span>);
    <span class="hljs-keyword">this</span>.staticCanvas            = document.getElementById(<span class="hljs-string">'static'</span>);
    <span class="hljs-keyword">this</span>.movingCanvas            = document.getElementById(<span class="hljs-string">'moving'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Test to see if canvas is supported</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.gridCanvas.getContext) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Canvas variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> canvasWidth          = <span class="hljs-keyword">this</span>.gridSize * <span class="hljs-keyword">this</span>.NUM_COLS;
        <span class="hljs-keyword">var</span> canvasHeight         = <span class="hljs-keyword">this</span>.gridSize * <span class="hljs-keyword">this</span>.NUM_ROWS;

        <span class="hljs-keyword">this</span>.gridContext         = <span class="hljs-keyword">this</span>.gridCanvas.getContext(<span class="hljs-string">'2d'</span>);
        <span class="hljs-keyword">this</span>.staticContext       = <span class="hljs-keyword">this</span>.staticCanvas.getContext(<span class="hljs-string">'2d'</span>);
        <span class="hljs-keyword">this</span>.movingContext       = <span class="hljs-keyword">this</span>.movingCanvas.getContext(<span class="hljs-string">'2d'</span>);

        <span class="hljs-keyword">this</span>.gridCanvas.width    = canvasWidth;
        <span class="hljs-keyword">this</span>.gridCanvas.height   = canvasHeight;
        <span class="hljs-keyword">this</span>.staticCanvas.width  = canvasWidth;
        <span class="hljs-keyword">this</span>.staticCanvas.height = canvasHeight;
        <span class="hljs-keyword">this</span>.movingCanvas.width  = canvasWidth;
        <span class="hljs-keyword">this</span>.movingCanvas.height = canvasHeight;

        $(<span class="hljs-string">'.canvases'</span>).width(<span class="hljs-keyword">this</span>.gridWidth-<span class="hljs-number">2</span>);
        $(<span class="hljs-string">'.canvases'</span>).height(<span class="hljs-keyword">this</span>.gridHeight-<span class="hljs-number">2</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

<span class="hljs-comment">/*****************************************************************************
 * RUN
 *  Runs the application on window.onload.
 ****************************************************************************/</span>
Digsim.prototype.run = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.init()) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Assign functions to events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"mousedown"</span>,              <span class="hljs-keyword">this</span>.onMouseDown);
        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"mouseup"</span>,                <span class="hljs-keyword">this</span>.onMouseUp);
        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"click"</span>,                  <span class="hljs-keyword">this</span>.onClick);
        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"dblclick"</span>,               <span class="hljs-keyword">this</span>.onDoubleClick);
        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"mousemove"</span>,              <span class="hljs-keyword">this</span>.onMouseMove);
        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"mouseout"</span>,               <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> digsim.mouseDown = <span class="hljs-literal">false</span>; });
        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"touchstart"</span>,             <span class="hljs-keyword">this</span>.onMouseDown);
        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"touchmove"</span>,              <span class="hljs-keyword">this</span>.onMouseMove);
        $(<span class="hljs-string">"canvas"</span>       ).on( <span class="hljs-string">"touchend"</span>,               <span class="hljs-keyword">this</span>.onMouseUp);
        $(<span class="hljs-string">"#New"</span>         ).on( <span class="hljs-string">"click"</span>,                  <span class="hljs-keyword">this</span>.newFile);
        $(<span class="hljs-string">'#Save'</span>        ).on( <span class="hljs-string">"click"</span>,                  <span class="hljs-keyword">this</span>.saveFile);
        $(<span class="hljs-string">'#uploadFile'</span>  ).on( <span class="hljs-string">"change"</span>,                 <span class="hljs-keyword">this</span>.submitFile);
        $(<span class="hljs-string">'#fileContents'</span>).on( <span class="hljs-string">"load"</span>,                   <span class="hljs-keyword">this</span>.readFileContents);
        $(<span class="hljs-string">"#Toggle_Grid"</span> ).on( <span class="hljs-string">"click"</span>,                  <span class="hljs-keyword">this</span>.toggleGrid);
        $(<span class="hljs-string">"#Zoom_In"</span>     ).on( <span class="hljs-string">"click"</span>, {dir:  <span class="hljs-number">1</span>},       <span class="hljs-keyword">this</span>.zoom);
        $(<span class="hljs-string">"#Zoom_Out"</span>    ).on( <span class="hljs-string">"click"</span>, {dir: -<span class="hljs-number">1</span>},       <span class="hljs-keyword">this</span>.zoom);
        $(<span class="hljs-string">'#Delete'</span>      ).on( <span class="hljs-string">"click"</span>,                  <span class="hljs-keyword">this</span>.delete);
        $(<span class="hljs-string">'#Rotate_CCW'</span>  ).on( <span class="hljs-string">"click"</span>, {dir: <span class="hljs-number">270</span>},      <span class="hljs-keyword">this</span>.rotate);
        $(<span class="hljs-string">'#Rotate_CW'</span>   ).on( <span class="hljs-string">"click"</span>, {dir: <span class="hljs-number">90</span>},       <span class="hljs-keyword">this</span>.rotate);
        $(<span class="hljs-string">'#Cut'</span>         ).on( <span class="hljs-string">"click"</span>,                  <span class="hljs-keyword">this</span>.cut);
        $(<span class="hljs-string">'#Copy'</span>        ).on( <span class="hljs-string">"click"</span>,                  <span class="hljs-keyword">this</span>.copy);
        $(<span class="hljs-string">'#Paste'</span>       ).on( <span class="hljs-string">"click"</span>,                  <span class="hljs-keyword">this</span>.paste);
        $(<span class="hljs-string">".gates &gt; ul a, .io a, .modes a"</span>).on(<span class="hljs-string">"click"</span>,  <span class="hljs-keyword">this</span>.onButtonClicked);
        $(<span class="hljs-string">'#2-input, #3-input, #4-input'</span>).on(<span class="hljs-string">"click"</span>,    <span class="hljs-keyword">this</span>.changeNumInputs);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Component menu events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'.component-menu'</span>).draggable();
        $(<span class="hljs-string">'#component-save'</span>).on(  <span class="hljs-string">"click"</span>,               <span class="hljs-keyword">this</span>.onSaveComponentEdit);
        $(<span class="hljs-string">'#component-cancel'</span>).on(<span class="hljs-string">"click"</span>,               <span class="hljs-keyword">this</span>.hideComponentMenu);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Set hotkey info on buttons</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> curr, hotkey;
        $(<span class="hljs-string">"li a"</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            curr = $(<span class="hljs-keyword">this</span>);
            hotkey = digsim.HOT_KEYS[curr.attr(<span class="hljs-string">'id'</span>)];
            <span class="hljs-keyword">if</span> (hotkey) {
                curr.attr(<span class="hljs-string">'title'</span>, curr.attr(<span class="hljs-string">'title'</span>) + <span class="hljs-string">" ("</span> + hotkey + <span class="hljs-string">")"</span>);
            }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Disable buttons on start</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.disableButton(<span class="hljs-string">"Empty"</span>);
        <span class="hljs-keyword">this</span>.disableControlButtons();

        <span class="hljs-keyword">this</span>.drawGrid(<span class="hljs-keyword">this</span>.gridContext);
        $(<span class="hljs-string">'.messages'</span>).css(<span class="hljs-string">'height'</span>, <span class="hljs-keyword">this</span>.gridHeight - <span class="hljs-number">37</span>);
    }
};

<span class="hljs-comment">/*****************************************************************************
 * CLEAR CANVAS
 *  Clears the given canvas.
 * @param {CanvasRenderingContext2D} context    - Context to clear.
 * @param {boolean}                  clearDirty - Clear only the parts that have changed.
 ****************************************************************************/</span>
Digsim.prototype.clearCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(context, clearDirty)</span> {</span>
    context.save();</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Use the identity matrix while clearing the canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    context.setTransform(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Use a dirty rectangle to clear the canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (clearDirty) {
        <span class="hljs-keyword">var</span> mousePos = digsim.getMousePos();
        <span class="hljs-keyword">var</span> max = <span class="hljs-built_in">Math</span>.max(<span class="hljs-keyword">this</span>.gridWidth, <span class="hljs-keyword">this</span>.gridHeight);
        <span class="hljs-keyword">var</span> half = max / <span class="hljs-number">2</span> | <span class="hljs-number">0</span>;

        context.clearRect(mousePos.x - half, mousePos.y - half, max, max);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Clear the entire canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
        context.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, context.canvas.width, context.canvas.width);
    }

    context.restore();
};

<span class="hljs-comment">/*****************************************************************************
 * DRAW GRID
 *  Draws the underlying blue grid on the gridContext.
 ****************************************************************************/</span>
Digsim.prototype.drawGrid = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>clear the canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">this</span>.gridContext;
    <span class="hljs-keyword">this</span>.clearCanvas(context);

    <span class="hljs-keyword">var</span> row, col;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Grid grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.gridToggle % <span class="hljs-number">3</span> === <span class="hljs-number">0</span>) {
        context.strokeStyle = <span class="hljs-string">'#8DCFF4'</span>;
        context.lineWidth = <span class="hljs-number">1</span>;
        context.save();
        context.translate(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);
        context.beginPath();</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Draw the columns</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (col = <span class="hljs-number">1</span>; col &lt; <span class="hljs-keyword">this</span>.NUM_COLS; col++) {
            context.moveTo(col * <span class="hljs-keyword">this</span>.gridSize, <span class="hljs-number">0</span>);
            context.lineTo(col * <span class="hljs-keyword">this</span>.gridSize, <span class="hljs-keyword">this</span>.NUM_COLS * <span class="hljs-keyword">this</span>.gridSize);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Draw the rows</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (row = <span class="hljs-number">1</span>; row &lt; <span class="hljs-keyword">this</span>.NUM_ROWS; row++) {
            context.moveTo(<span class="hljs-number">0</span>, row * <span class="hljs-keyword">this</span>.gridSize);
            context.lineTo(<span class="hljs-keyword">this</span>.NUM_ROWS * <span class="hljs-keyword">this</span>.gridSize, row * <span class="hljs-keyword">this</span>.gridSize);
        }
        context.stroke();
        context.restore();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Dotted Grid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.gridToggle % <span class="hljs-number">3</span> === <span class="hljs-number">1</span>) {
        context.fillStyle = <span class="hljs-string">'#0d91db'</span>;
        context.lineWidth = <span class="hljs-number">1</span>;
        context.save();
        context.translate(digsim.gridSize / <span class="hljs-number">2</span> - <span class="hljs-number">0.5</span>,digsim.gridSize / <span class="hljs-number">2</span> - <span class="hljs-number">0.5</span>);
        context.beginPath();

        <span class="hljs-keyword">for</span> (col = <span class="hljs-number">0</span>; col &lt; <span class="hljs-keyword">this</span>.NUM_COLS; ++col) {
            <span class="hljs-keyword">for</span> (row = <span class="hljs-number">0</span>; row &lt; <span class="hljs-keyword">this</span>.NUM_ROWS; ++row) {
                context.fillRect(col * digsim.gridSize, row * digsim.gridSize, <span class="hljs-number">1.5</span>, <span class="hljs-number">1.5</span>);
            }
        }
        context.stroke();
        context.restore();
    }
};

<span class="hljs-comment">/**************************************************************************************************************
 *      /$$$$$$                                                                              /$$
 *     /$$__  $$                                                                            | $$
 *    | $$  \__/  /$$$$$$  /$$$$$$/$$$$   /$$$$$$   /$$$$$$  /$$$$$$$   /$$$$$$  /$$$$$$$  /$$$$$$    /$$$$$$$
 *    | $$       /$$__  $$| $$_  $$_  $$ /$$__  $$ /$$__  $$| $$__  $$ /$$__  $$| $$__  $$|_  $$_/   /$$_____/
 *    | $$      | $$  \ $$| $$ \ $$ \ $$| $$  \ $$| $$  \ $$| $$  \ $$| $$$$$$$$| $$  \ $$  | $$    |  $$$$$$
 *    | $$    $$| $$  | $$| $$ | $$ | $$| $$  | $$| $$  | $$| $$  | $$| $$_____/| $$  | $$  | $$ /$$ \____  $$
 *    |  $$$$$$/|  $$$$$$/| $$ | $$ | $$| $$$$$$$/|  $$$$$$/| $$  | $$|  $$$$$$$| $$  | $$  |  $$$$/ /$$$$$$$/
 *     \______/  \______/ |__/ |__/ |__/| $$____/  \______/ |__/  |__/ \_______/|__/  |__/   \___/  |_______/
 *                                      | $$
 *                                      | $$
 *                                      |__/
 *                               /$$
 *                              | $$
 *      /$$$$$$  /$$$$$$$   /$$$$$$$
 *     |____  $$| $$__  $$ /$$__  $$
 *      /$$$$$$$| $$  \ $$| $$  | $$
 *     /$$__  $$| $$  | $$| $$  | $$
 *    |  $$$$$$$| $$  | $$|  $$$$$$$
 *     \_______/|__/  |__/ \_______/
 *
 *
 *
 *     /$$$$$$$  /$$                               /$$                 /$$       /$$
 *    | $$__  $$| $$                              | $$                | $$      | $$
 *    | $$  \ $$| $$  /$$$$$$   /$$$$$$$  /$$$$$$ | $$$$$$$   /$$$$$$ | $$  /$$$$$$$  /$$$$$$   /$$$$$$   /$$$$$$$
 *    | $$$$$$$/| $$ |____  $$ /$$_____/ /$$__  $$| $$__  $$ /$$__  $$| $$ /$$__  $$ /$$__  $$ /$$__  $$ /$$_____/
 *    | $$____/ | $$  /$$$$$$$| $$      | $$$$$$$$| $$  \ $$| $$  \ $$| $$| $$  | $$| $$$$$$$$| $$  \__/|  $$$$$$
 *    | $$      | $$ /$$__  $$| $$      | $$_____/| $$  | $$| $$  | $$| $$| $$  | $$| $$_____/| $$       \____  $$
 *    | $$      | $$|  $$$$$$$|  $$$$$$$|  $$$$$$$| $$  | $$|  $$$$$$/| $$|  $$$$$$$|  $$$$$$$| $$       /$$$$$$$/
 *    |__/      |__/ \_______/ \_______/ \_______/|__/  |__/ \______/ |__/ \_______/ \_______/|__/      |_______/
 *
 *
 *
 *****************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * DRAW ALL COMPONENTS
 *  Draw all the components on the static canvas.
 ****************************************************************************/</span>
Digsim.prototype.drawAllComponents = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.clearCanvas(<span class="hljs-keyword">this</span>.staticContext);

    <span class="hljs-keyword">var</span> comps = <span class="hljs-keyword">this</span>.components.get();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = comps.length; i &lt; len; i++) {
        <span class="hljs-keyword">var</span> component = comps[i];

        <span class="hljs-keyword">if</span> (component.drawStatic)
            component.draw(<span class="hljs-keyword">this</span>.staticContext);
    }

};

<span class="hljs-comment">/*****************************************************************************
 * DRAW COMPONENT
 *  Draw a component to a context.
 * @param {Component}                comp    - Component to draw.
 * @param {CanvasRenderingContext2D} context - Context to draw on.
 * @param {string}                   color   - Color to use to draw the object @default 'black'.
 ****************************************************************************/</span>
Digsim.prototype.drawComponent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(comp, context, color)</span> {</span>
    <span class="hljs-keyword">if</span> (!context)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Must call function 'drawComponent' with a context."</span>);

    comp.draw(context, color);
};

<span class="hljs-comment">/*****************************************************************************
 * GET COMPONENT
 *  Return the Component at the mouse position.
 * @return {Component}
 ****************************************************************************/</span>
Digsim.prototype.getComponent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> ph = digsim.placeholders[digsim.getMouseRow()][digsim.getMouseCol()];
    <span class="hljs-keyword">var</span> index, comp;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Get the Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (ph <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) { <span class="hljs-comment">// NOTE:: This will be true on objects</span>
        index = digsim.getWireIndex();
        <span class="hljs-keyword">if</span> (index != -<span class="hljs-number">1</span> &amp;&amp; ph[index])
            comp = digsim.components.getComponent(ph[index].ref);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ph) {
        comp = digsim.components.getComponent(ph.ref);
    }

    <span class="hljs-keyword">return</span> comp;
};

<span class="hljs-comment">/*****************************************************************************
 * DELETE COMPONENT
 *  Remove a component from the components array, delete it from all of its
 *  connections, then delete its placeholders.
 * @param {Component} comp - Component to delete.
 ****************************************************************************/</span>
Digsim.prototype.deleteComponent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(comp)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>If itâ€™s a driver, remove it from the drivers array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === <span class="hljs-keyword">this</span>.SWITCH || comp.type === <span class="hljs-keyword">this</span>.CLOCK) {
        <span class="hljs-keyword">this</span>.drivers.splice(<span class="hljs-keyword">this</span>.drivers.indexOf(comp.id), <span class="hljs-number">1</span>);
    }
    <span class="hljs-keyword">this</span>.disableControlButtons();
    <span class="hljs-keyword">this</span>.components.remove(comp, <span class="hljs-literal">false</span>);
    comp.deleteConnections();
    <span class="hljs-keyword">this</span>.deletePlaceholder(comp);
};

<span class="hljs-comment">/*****************************************************************************
 * SET PLACEHOLDERS
 *  Add component to the placeholders array with a unique identifier.
 * @param {Component} comp    - Component to create placeholders.
 * @param {boolean}   nocheck - Set to true to skip collision detection.
 * @return {boolean} True if all placeholders were successfully placed.
 ****************************************************************************/</span>
Digsim.prototype.setPlaceholders = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(comp, nocheck)</span> {</span>
    <span class="hljs-keyword">var</span> space = comp.getComponentSpace();
    <span class="hljs-keyword">var</span> i, ph;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Check the component space for collision</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!nocheck) {
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; space.length; i++) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> space[i].index !== <span class="hljs-string">'undefined'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>If grid space is not an array and already contains a placeholder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &amp;&amp;
                    <span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col]) {
                    digsim.addMessage(digsim.WARNING, <span class="hljs-string">"[1]Collision detected! Unable to place component."</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>If grid space is an array and already contains a placeholder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &amp;&amp;
                        <span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col][space[i].index]) {
                    digsim.addMessage(digsim.WARNING, <span class="hljs-string">"[2]Collision detected! Unable to place component."</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
            <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>If gird space already contains a placeholder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col]) {
                    digsim.addMessage(digsim.WARNING, <span class="hljs-string">"[3]Collision detected! Unable to place component. "</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Set the placeholders</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; space.length; i++) {
        <span class="hljs-comment">/*****************************************************************************
         * Placeholder
         * @param {number}  ref         - Unique id of the component whose placeholder this is.
         * @param {boolean} connectable - If the placeholder can be used for determining connections.
         * @param {number}  name        - Name of the connection (DFF)
         ****************************************************************************/</span>
        ph = {
            <span class="hljs-string">'ref'</span>         : comp.id,
            <span class="hljs-string">'connectable'</span> : space[i].con,
            <span class="hljs-string">'name'</span>        : space[i].name
        };

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> space[i].index !== <span class="hljs-string">'undefined'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>If itâ€™s not a 3D array, make it a 3D array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>)) {
                <span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col] = [];
            }
            <span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col][space[i].index] = ph;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.placeholders[space[i].row][space[i].col] = ph;
        }

    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

<span class="hljs-comment">/*****************************************************************************
 * DELETE PLACEHOLDER
 *  Delete component placeholders
 * @param {Component} comp - Component whose placeholders to delete.
 ****************************************************************************/</span>
Digsim.prototype.deletePlaceholder = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(comp)</span> {</span>

    <span class="hljs-keyword">var</span> spaces = comp.getComponentSpace();
    <span class="hljs-keyword">var</span> space;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; spaces.length; i++) {
        space = spaces[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Delete an array index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> space.index !== <span class="hljs-string">'undefined'</span>) {
            <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.placeholders[space.row][space.col][space.index];</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Delete empty placeholder arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.placeholders[space.row][space.col] || {}).length === <span class="hljs-number">0</span>)
                <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.placeholders[space.row][space.col];
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.placeholders[space.row][space.col];
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Visually remove the component from static canvas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.drawAllComponents();
};


<span class="hljs-comment">/**************************************************************************************************************
 *     /$$$$$$$                      /$$
 *    | $$__  $$                    |__/
 *    | $$  \ $$  /$$$$$$   /$$$$$$$ /$$ /$$$$$$$$  /$$$$$$
 *    | $$$$$$$/ /$$__  $$ /$$_____/| $$|____ /$$/ /$$__  $$
 *    | $$__  $$| $$$$$$$$|  $$$$$$ | $$   /$$$$/ | $$$$$$$$
 *    | $$  \ $$| $$_____/ \____  $$| $$  /$$__/  | $$_____/
 *    | $$  | $$|  $$$$$$$ /$$$$$$$/| $$ /$$$$$$$$|  $$$$$$$
 *    |__/  |__/ \_______/|_______/ |__/|________/ \_______/
 *
 *
 *
 *     /$$$$$$$$                                  /$$
 *    | $$_____/                                 | $$
 *    | $$       /$$    /$$  /$$$$$$  /$$$$$$$  /$$$$$$
 *    | $$$$$   |  $$  /$$/ /$$__  $$| $$__  $$|_  $$_/
 *    | $$__/    \  $$/$$/ | $$$$$$$$| $$  \ $$  | $$
 *    | $$        \  $$$/  | $$_____/| $$  | $$  | $$ /$$
 *    | $$$$$$$$   \  $/   |  $$$$$$$| $$  | $$  |  $$$$/
 *    |________/    \_/     \_______/|__/  |__/   \___/
 *
 *
 *
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * WINDOW RESIZE
 *  Change the width and height of the canvas to match the browser size.
 ****************************************************************************/</span>
$(window).resize(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Resize grid width and height</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    digsim.gridWidth = window.innerWidth - $(<span class="hljs-string">'.canvases'</span>).position().left;
    digsim.gridHeight = window.innerHeight - $(<span class="hljs-string">'.canvases'</span>).position().top;

    digsim.drawGrid(digsim.gridContext);
    digsim.drawAllComponents();</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Resize GUI elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'.canvases'</span>).width(digsim.gridWidth-<span class="hljs-number">2</span>).height(digsim.gridHeight-<span class="hljs-number">2</span>);
    $(<span class="hljs-string">'.messages'</span>).css(<span class="hljs-string">'height'</span>, digsim.gridHeight - <span class="hljs-number">37</span>);
});

<span class="hljs-comment">/**************************************************************************************************************
 *     /$$   /$$                     /$$                                           /$$
 *    | $$  /$$/                    | $$                                          | $$
 *    | $$ /$$/   /$$$$$$  /$$   /$$| $$$$$$$   /$$$$$$   /$$$$$$   /$$$$$$   /$$$$$$$
 *    | $$$$$/   /$$__  $$| $$  | $$| $$__  $$ /$$__  $$ |____  $$ /$$__  $$ /$$__  $$
 *    | $$  $$  | $$$$$$$$| $$  | $$| $$  \ $$| $$  \ $$  /$$$$$$$| $$  \__/| $$  | $$
 *    | $$\  $$ | $$_____/| $$  | $$| $$  | $$| $$  | $$ /$$__  $$| $$      | $$  | $$
 *    | $$ \  $$|  $$$$$$$|  $$$$$$$| $$$$$$$/|  $$$$$$/|  $$$$$$$| $$      |  $$$$$$$
 *    |__/  \__/ \_______/ \____  $$|_______/  \______/  \_______/|__/       \_______/
 *                         /$$  | $$
 *                        |  $$$$$$/
 *                         \______/
 *     /$$$$$$$$                                  /$$
 *    | $$_____/                                 | $$
 *    | $$       /$$    /$$  /$$$$$$  /$$$$$$$  /$$$$$$
 *    | $$$$$   |  $$  /$$/ /$$__  $$| $$__  $$|_  $$_/
 *    | $$__/    \  $$/$$/ | $$$$$$$$| $$  \ $$  | $$
 *    | $$        \  $$$/  | $$_____/| $$  | $$  | $$ /$$
 *    | $$$$$$$$   \  $/   |  $$$$$$$| $$  | $$  |  $$$$/
 *    |________/    \_/     \_______/|__/  |__/   \___/
 *
 *
 *
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * KEY EVENTS
 *  Activate a button based on keyCode dictionary.
 * @param {Event} event - Key down event.
 ****************************************************************************/</span>
document.onkeydown = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Get which key was pressed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> keyCode = (event.keyCode ? event.keyCode : event.charCode); <span class="hljs-comment">// Firefox and Opera use charCode instead of keyCode</span>
    <span class="hljs-keyword">var</span> id;</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Donâ€™t enable hot keys if the edit menu is open</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.mode !== digsim.EDIT_MODE) {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Prevent tabbing of buttons</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (keyCode === <span class="hljs-number">9</span>) {
            event.preventDefault();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Make the delete key on MAC delete a Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (keyCode === <span class="hljs-number">8</span>) {
            keyCode = <span class="hljs-number">46</span>; <span class="hljs-comment">// Switch the keyCode to the delete button</span>
            event.preventDefault();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Enter key opens the edit menu if a Component is selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (keyCode === <span class="hljs-number">13</span> &amp;&amp; digsim.selectedComponent &amp;&amp; digsim.selectedComponent.type !== digsim.WIRE) {
            digsim.showComponentMenu();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Donâ€™t do anything when MAC user refreshes (shift+R is the hot key for NOR gate)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!(keyCode === <span class="hljs-number">82</span> &amp;&amp; event.metaKey)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Add the â€˜sâ€™ for shift key combinations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span>(event.shiftKey) {
                id = digsim.KEY_CODES[<span class="hljs-string">'s'</span>+keyCode];
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Add the â€˜câ€™ for ctrl key combinations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.ctrlKey) {
                id = digsim.KEY_CODES[<span class="hljs-string">'c'</span>+keyCode];
            }
            <span class="hljs-keyword">else</span> {
                id = digsim.KEY_CODES[keyCode];
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Esc key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (id === <span class="hljs-string">'esc'</span>) {
                digsim.deactivateButtons();
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (id) {</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Only click active buttons</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span>(!$(<span class="hljs-string">'#'</span>+id).hasClass(<span class="hljs-string">'disabled'</span>)) {
                    $(<span class="hljs-string">"#"</span> + id).click();
                }
            }
        }
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Esc key closes menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (keyCode === <span class="hljs-number">27</span>) {
            digsim.hideComponentMenu();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Enter key saves edit as long as there is focus on an input box</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (keyCode === <span class="hljs-number">13</span> &amp;&amp; $(<span class="hljs-string">'.component-menu input'</span>).is(<span class="hljs-string">":focus"</span>)) {
            digsim.onSaveComponentEdit();
        }
    }
};

<span class="hljs-comment">/**************************************************************************************************************
 *     /$$      /$$
 *    | $$$    /$$$
 *    | $$$$  /$$$$  /$$$$$$  /$$   /$$  /$$$$$$$  /$$$$$$
 *    | $$ $$/$$ $$ /$$__  $$| $$  | $$ /$$_____/ /$$__  $$
 *    | $$  $$$| $$| $$  \ $$| $$  | $$|  $$$$$$ | $$$$$$$$
 *    | $$\  $ | $$| $$  | $$| $$  | $$ \____  $$| $$_____/
 *    | $$ \/  | $$|  $$$$$$/|  $$$$$$/ /$$$$$$$/|  $$$$$$$
 *    |__/     |__/ \______/  \______/ |_______/  \_______/
 *
 *
 *
 *     /$$$$$$$$                                  /$$
 *    | $$_____/                                 | $$
 *    | $$       /$$    /$$  /$$$$$$  /$$$$$$$  /$$$$$$    /$$$$$$$
 *    | $$$$$   |  $$  /$$/ /$$__  $$| $$__  $$|_  $$_/   /$$_____/
 *    | $$__/    \  $$/$$/ | $$$$$$$$| $$  \ $$  | $$    |  $$$$$$
 *    | $$        \  $$$/  | $$_____/| $$  | $$  | $$ /$$ \____  $$
 *    | $$$$$$$$   \  $/   |  $$$$$$$| $$  | $$  |  $$$$/ /$$$$$$$/
 *    |________/    \_/     \_______/|__/  |__/   \___/  |_______/
 *
 *
 *
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * ON MOUSE MOVE
 *  Set the mouse position and change the cursor based on the mode. Also detects
 *  when a Component is being moved.
 * @param {Event} event - Mouse move event.
 ****************************************************************************/</span>
Digsim.prototype.onMouseMove = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>TODO: fix bug with scolling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> mouseX = event.offsetX || event.layerX || event.clientX - $(<span class="hljs-string">".canvases"</span>).position().left;
    <span class="hljs-keyword">var</span> mouseY = event.offsetY || event.layerY || event.clientY - $(<span class="hljs-string">".canvases"</span>).position().top;
    digsim.mousePos = { x: mouseX, y: mouseY };

    <span class="hljs-keyword">var</span> comp = digsim.getComponent();</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Show movable Components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.mode === digsim.DEFAULT_MODE &amp;&amp; comp &amp;&amp; !digsim.dragging) {
        <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE) {
            <span class="hljs-keyword">if</span> (comp.dx)
                $(<span class="hljs-string">"canvas"</span>).css(<span class="hljs-string">'cursor'</span>,<span class="hljs-string">'row-resize'</span>);
            <span class="hljs-keyword">else</span>
                $(<span class="hljs-string">"canvas"</span>).css(<span class="hljs-string">'cursor'</span>,<span class="hljs-string">'col-resize'</span>);
        }
        <span class="hljs-keyword">else</span>
            $(<span class="hljs-string">"canvas"</span>).css(<span class="hljs-string">'cursor'</span>,<span class="hljs-string">'move'</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (digsim.mode === digsim.EDIT_MODE) {
        $(<span class="hljs-string">"canvas"</span>).css(<span class="hljs-string">'cursor'</span>,<span class="hljs-string">'default'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Show clickable Components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (digsim.mode === digsim.SIM_MODE &amp;&amp; comp &amp;&amp; comp.type === digsim.SWITCH) {
        $(<span class="hljs-string">"canvas"</span>).css(<span class="hljs-string">'cursor'</span>,<span class="hljs-string">'pointer'</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (digsim.mode === digsim.WIRE_MODE) {
        $(<span class="hljs-string">"canvas"</span>).css(<span class="hljs-string">'cursor'</span>,<span class="hljs-string">'crosshair'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Donâ€™t change the last cursor if dragging</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!digsim.dragging) {
        $(<span class="hljs-string">"canvas"</span>).css(<span class="hljs-string">'cursor'</span>,<span class="hljs-string">'default'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Set dragging if the selectedComponent has moved</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( digsim.mouseDown &amp;&amp; digsim.selectedComponent &amp;&amp; !digsim.dragging &amp;&amp;
        (digsim.getMouseRow() !== digsim.dragStart.row ||
         digsim.getMouseCol() !== digsim.dragStart.col) ) {
        digsim.dragging = <span class="hljs-literal">true</span>;
        digsim.prepDragging();
        animate();
    }
};

<span class="hljs-comment">/*****************************************************************************
 * ON MOUSE DOWN
 *  Select a Component.
 * @param {Event} event - Mouse down event.
 ****************************************************************************/</span>
Digsim.prototype.onMouseDown = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    event.preventDefault();
    digsim.mouseDown = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Only handle left click events in DEFAULT_MODE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (event.button !== <span class="hljs-number">0</span> || digsim.mode !== digsim.DEFAULT_MODE) {
        <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>If there is a dragging Component we need to place it instead of move it
This only happens when the user moves the mouse off the canvas while still holding down the mouse button and releases</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.dragging) {
        $(<span class="hljs-string">"canvas"</span>).mouseup();
        <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Redraw Components if there is already a selected Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.selectedComponent)
        digsim.drawAllComponents();</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Select a Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> comp = digsim.getComponent();
    <span class="hljs-keyword">if</span> (comp) {
        digsim.selectedComponent = comp;
        digsim.dragStart = {<span class="hljs-string">'row'</span>: digsim.getMouseRow(), <span class="hljs-string">'col'</span>: digsim.getMouseCol()};
        digsim.dragOffset = {<span class="hljs-string">'row'</span>: digsim.getMouseRow() - comp.row, <span class="hljs-string">'col'</span>: digsim.getMouseCol() - comp.col};
        digsim.drawComponent(comp, digsim.staticContext, <span class="hljs-string">'red'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Show Control options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (comp.type !== digsim.WIRE) {
            digsim.enableButton(<span class="hljs-string">'Cut'</span>);
            digsim.enableButton(<span class="hljs-string">'Copy'</span>);
            digsim.enableButton(<span class="hljs-string">'Delete'</span>);
            digsim.enableButton(<span class="hljs-string">'Rotate_CCW'</span>);
            digsim.enableButton(<span class="hljs-string">'Rotate_CW'</span>);
        }
        <span class="hljs-keyword">else</span> {
            digsim.disableButton(<span class="hljs-string">'Cut'</span>);
            digsim.disableButton(<span class="hljs-string">'Copy'</span>);
            digsim.disableButton(<span class="hljs-string">'Rotate_CCW'</span>);
            digsim.disableButton(<span class="hljs-string">'Rotate_CW'</span>);
            digsim.enableButton(<span class="hljs-string">'Delete'</span>);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Empty square</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
        digsim.dragStart  = {<span class="hljs-string">'row'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'col'</span>: <span class="hljs-number">0</span>};
        digsim.dragOffset = {<span class="hljs-string">'row'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'col'</span>: <span class="hljs-number">0</span>};
        digsim.dragging   = <span class="hljs-literal">false</span>;
        digsim.disableControlButtons();
    }
};

<span class="hljs-comment">/*****************************************************************************
 * ON MOUSE UP
 *  Place a dragging Component.
 * @param {Event} event - Mouse up event.
 ****************************************************************************/</span>
Digsim.prototype.onMouseUp = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    event.preventDefault();
    digsim.mouseDown = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Only handle left click events in DEFAULT_MODE or PLACE_MODE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (event.button !== <span class="hljs-number">0</span> || digsim.mode === digsim.WIRE_MODE || digsim.mode === digsim.SIM_MODE ||
        digsim.mode === digsim.EDIT_MODE || !digsim.dragging) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> comp = digsim.selectedComponent;
    <span class="hljs-keyword">var</span> validPlacement = digsim.setPlaceholders(comp);
    <span class="hljs-keyword">var</span> Class;</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Place a dragging Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.mode === digsim.DEFAULT_MODE &amp;&amp; validPlacement) {
        digsim.dragging = <span class="hljs-literal">false</span>;
        comp.drawStatic = <span class="hljs-literal">true</span>;
        digsim.clearCanvas(digsim.movingContext);</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Keep Components connected by creating wires between them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> start, target, connectedComp;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> digsim.connectionStarts) {
            <span class="hljs-keyword">if</span> (digsim.connectionStarts.hasOwnProperty(i)) {
                connectedComp = digsim.components.getComponent(i);
                start = digsim.connectionStarts[i];
                target = digsim.connectionTargets[i];

                target = {<span class="hljs-string">'r'</span>: comp.row + target.r, <span class="hljs-string">'c'</span>: comp.col + target.c};</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Update an existing Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (start.r &gt;= <span class="hljs-number">0</span> &amp;&amp; target.r &gt;= <span class="hljs-number">0</span> &amp;&amp; connectedComp &amp;&amp; connectedComp.type === digsim.WIRE) {
                    digsim.route(start, target, <span class="hljs-literal">false</span>, connectedComp);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Wire was merged out</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (connectedComp.path.x === <span class="hljs-number">0</span> &amp;&amp; connectedComp.path.y === <span class="hljs-number">0</span>) {
                        digsim.components.remove(connectedComp);
                    }
                    <span class="hljs-keyword">else</span> {
                        connectedComp.drawStatic = <span class="hljs-literal">true</span>;
                        connectedComp.deleteConnections();
                        connectedComp.checkConnections();
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Create a new Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (start.r &gt;= <span class="hljs-number">0</span> &amp;&amp; target.r &gt;= <span class="hljs-number">0</span>) {
                    digsim.route(start, target);

                    console.assert(<span class="hljs-keyword">typeof</span> connectedComp !== <span class="hljs-string">"undefined"</span>, <span class="hljs-string">"Gage: Connected component is undefined?"</span>);
                    connectedComp.deleteConnections();
                    connectedComp.checkConnections();
                }
            }
        }

        digsim.connectionStarts = {};
        digsim.connectionTargets = {};

        comp.deleteConnections();
        comp.checkConnections();
        digsim.drawAllComponents();
        digsim.drawComponent(comp, digsim.staticContext, <span class="hljs-string">'red'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Place a new Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (digsim.mode === digsim.PLACE_MODE &amp;&amp; validPlacement) {</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Keep track of all drivers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (comp.isADriver()) {
            digsim.drivers.push(comp.id);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Place the Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        digsim.clearCanvas(digsim.movingContext);
        digsim.components.add(comp);
        digsim.iComp++;
        comp.checkConnections();
        digsim.drawComponent(comp, digsim.staticContext);</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Button is active so create another Component to place</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>($(<span class="hljs-string">'.gates &gt; ul a'</span>).hasClass(<span class="hljs-string">'active'</span>) || $(<span class="hljs-string">'.io a'</span>).hasClass(<span class="hljs-string">'active'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>JavaScript Reflection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            Class = window[comp.name];
            comp = <span class="hljs-keyword">new</span> Class(digsim.numGateInputs);
            comp.init(digsim.selectedComponent.row, digsim.selectedComponent.col, digsim.rotation, digsim.iComp);

            digsim.dragging = <span class="hljs-literal">true</span>;
            digsim.selectedComponent = comp;
            digsim.drawComponent(digsim.selectedComponent, digsim.movingContext);
            animate();
        }
        <span class="hljs-keyword">else</span> {
            digsim.dragging = <span class="hljs-literal">false</span>;
            digsim.mode = digsim.DEFAULT_MODE;
            digsim.disableControlButtons();
        }
    }
};

<span class="hljs-comment">/*****************************************************************************
 * ON GRID CLICK
 *  Place wires in WIRE_MODE, change states of Switches in SIM_MODE, and close
 *  the Component edit menu in EDIT_MODE.
 * @param {Event} event - Mouse click event.
 ****************************************************************************/</span>
Digsim.prototype.onClick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    event.preventDefault();
    digsim.mouseDown = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Only handle left click events in WIRE_MODE, SIM_MODE, or EDIT_MODE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (event.button !== <span class="hljs-number">0</span> || digsim.mode === digsim.DEFAULT_MODE || digsim.mode === digsim.PLACE_MODE) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> row = digsim.getMouseRow();
    <span class="hljs-keyword">var</span> col = digsim.getMouseCol();
    <span class="hljs-keyword">var</span> comp, start, target;</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Close the edit menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.mode === digsim.EDIT_MODE) {
        digsim.hideComponentMenu();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Place a wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (digsim.mode === digsim.WIRE_MODE) {</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Start the placement of a Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!digsim.dragging) {</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Prevent wires from starting on top of placeholders</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">typeof</span> digsim.placeholders[row][col] === <span class="hljs-string">'undefined'</span> || digsim.placeholders[row][col] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) ||
                <span class="hljs-built_in">Object</span>.keys(digsim.placeholders[row][col] || {}).length === <span class="hljs-number">4</span>) {
                <span class="hljs-keyword">return</span>;
            }

            digsim.dragging = <span class="hljs-literal">true</span>;
            digsim.wireStart.col = col + <span class="hljs-number">0.5</span>;
            digsim.wireStart.row = row + <span class="hljs-number">0.5</span>;
            animateWire();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>End the placement of a Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> {
            start  = {<span class="hljs-string">'r'</span>: <span class="hljs-built_in">Math</span>.floor(digsim.wireStart.row), <span class="hljs-string">'c'</span>: <span class="hljs-built_in">Math</span>.floor(digsim.wireStart.col)};
            target = {<span class="hljs-string">'r'</span>: row, <span class="hljs-string">'c'</span>: col};

            digsim.route(start, target);
            digsim.clearCanvas(digsim.movingContext);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Change the state of a Switch</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (digsim.mode === digsim.SIM_MODE) {
        comp = digsim.getComponent();

        <span class="hljs-keyword">if</span> (comp &amp;&amp; comp.type === digsim.SWITCH) {
            digsim.passCounter = <span class="hljs-number">0</span>;
            comp.passState(!comp.state);
            digsim.drawAllComponents();
        }
    }
};

<span class="hljs-comment">/*****************************************************************************
 * ON GRID DOUBLE CLICK
 *  Open the component edit menu if a component is selected.
 * @param {Event} event - Mouse dblclick event.
 ****************************************************************************/</span>
Digsim.prototype.onDoubleClick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    event.preventDefault();
    digsim.mouseDown = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Only handle left click events in DEFAULT_MODE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (event.button !== <span class="hljs-number">0</span> || digsim.mode !== digsim.DEFAULT_MODE) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> comp = digsim.getComponent();

    <span class="hljs-keyword">if</span> (comp &amp;&amp; digsim.selectedComponent == comp &amp;&amp; comp.type !== digsim.WIRE) {
        digsim.showComponentMenu();
    }
};

<span class="hljs-comment">/**************************************************************************************************************
 *     /$$$$$$$              /$$       /$$
 *    | $$__  $$            | $$      | $$
 *    | $$  \ $$ /$$   /$$ /$$$$$$   /$$$$$$    /$$$$$$  /$$$$$$$
 *    | $$$$$$$ | $$  | $$|_  $$_/  |_  $$_/   /$$__  $$| $$__  $$
 *    | $$__  $$| $$  | $$  | $$      | $$    | $$  \ $$| $$  \ $$
 *    | $$  \ $$| $$  | $$  | $$ /$$  | $$ /$$| $$  | $$| $$  | $$
 *    | $$$$$$$/|  $$$$$$/  |  $$$$/  |  $$$$/|  $$$$$$/| $$  | $$
 *    |_______/  \______/    \___/     \___/   \______/ |__/  |__/
 *
 *
 *
 *     /$$$$$$$$                                  /$$
 *    | $$_____/                                 | $$
 *    | $$       /$$    /$$  /$$$$$$  /$$$$$$$  /$$$$$$    /$$$$$$$
 *    | $$$$$   |  $$  /$$/ /$$__  $$| $$__  $$|_  $$_/   /$$_____/
 *    | $$__/    \  $$/$$/ | $$$$$$$$| $$  \ $$  | $$    |  $$$$$$
 *    | $$        \  $$$/  | $$_____/| $$  | $$  | $$ /$$ \____  $$
 *    | $$$$$$$$   \  $/   |  $$$$$$$| $$  | $$  |  $$$$/ /$$$$$$$/
 *    |________/    \_/     \_______/|__/  |__/   \___/  |_______/
 *
 *
 *
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * ON BUTTON CLICKED
 *  Handle GUI Gates, I/O, and Modes button clicks.
 * @param {Event} event - Button click event.
 ****************************************************************************/</span>
Digsim.prototype.onButtonClicked = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    event.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Donâ€™t do anything if the button is disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> id = $(<span class="hljs-keyword">this</span>).attr(<span class="hljs-string">"id"</span>);
    <span class="hljs-keyword">var</span> comps, comp, i, j, Class, row, col, len;</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Activate button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!$(<span class="hljs-keyword">this</span>).hasClass(<span class="hljs-string">'active'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Remove the active class from all buttons that have it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        digsim.deactivateButtons($(<span class="hljs-string">'ul:not(.num-inputs) .active'</span>).attr(<span class="hljs-string">'id'</span>));
        $(<span class="hljs-keyword">this</span>).addClass(<span class="hljs-string">'active'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Wire mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (id == <span class="hljs-string">"Wire"</span>) {
            digsim.mode = digsim.WIRE_MODE;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Simulate Mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (id == <span class="hljs-string">"Run"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Error if there are no drivers in the schematic</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (digsim.drivers.length === <span class="hljs-number">0</span>) {
                digsim.addMessage(digsim.ERROR, <span class="hljs-string">"[16]Error: No drivers in schematic!"</span>);
                <span class="hljs-keyword">return</span>;
            }

            digsim.mode = digsim.SIM_MODE;</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Clear messages every new Run</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            digsim.clearMessages();</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Count the number of connections, inputs, and outputs of the schematic</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            digsim.maxSchematicLoop = <span class="hljs-number">0</span>;
            comps = digsim.components.get();
            <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, len = comps.length; j &lt; len; ++j) {
                comp = comps[j];</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Reset the state of all Components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                comp.reset();</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Count the number of connections the schematic has</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE) {
                    digsim.maxSchematicLoop += comp.connections.length();</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Reset input/output connections for a Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    comp.inputs.clear(<span class="hljs-literal">false</span>);
                    comp.outputs.clear(<span class="hljs-literal">false</span>);
                }
                <span class="hljs-keyword">else</span>
                    digsim.maxSchematicLoop += comp.numInputs + comp.numOutputs;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>Define a safety buffer to pass through</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            digsim.maxSchematicLoop *= <span class="hljs-number">3</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>NOTE: this may be the reason muxs somtimes missbehave.
Loop through each driver and pass state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = digsim.drivers.length; i &lt; len; ++i) {
                comp = digsim.components.getComponent(digsim.drivers[i]);</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Pass state if successfully traversed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (comp.traverseConnections()) {
                    digsim.passCounter = <span class="hljs-number">0</span>;
                    comp.passState(<span class="hljs-number">0</span>);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>There was an error so exit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span>
                    <span class="hljs-keyword">return</span>;
            }

            cycleClock();
            digsim.drawAllComponents();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Button to place a Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> {
            digsim.mode = digsim.PLACE_MODE;
            digsim.enableButton(<span class="hljs-string">'Rotate_CW'</span>);
            digsim.enableButton(<span class="hljs-string">'Rotate_CCW'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Use reflection to dynamically create gate based on id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            Class = window[id];
            comp = <span class="hljs-keyword">new</span> Class(digsim.numGateInputs);
            digsim.rotation = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Initialize the new object at the mouse position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            row = digsim.getMouseRow();
            col = digsim.getMouseCol();
            comp.init(row, col, digsim.rotation, digsim.iComp);

            digsim.dragging = <span class="hljs-literal">true</span>;
            digsim.dragOffset = {<span class="hljs-string">'row'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'col'</span>: <span class="hljs-number">0</span>};
            digsim.selectedComponent = comp;
            digsim.drawComponent(digsim.selectedComponent, digsim.movingContext);
            animate();
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Deactivate button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
        digsim.deactivateButtons(id);
    }
};

<span class="hljs-comment">/**************************************************************************************************************
 *     /$$$$$$$$ /$$ /$$
 *    | $$_____/|__/| $$
 *    | $$       /$$| $$  /$$$$$$
 *    | $$$$$   | $$| $$ /$$__  $$
 *    | $$__/   | $$| $$| $$$$$$$$
 *    | $$      | $$| $$| $$_____/
 *    | $$      | $$| $$|  $$$$$$$
 *    |__/      |__/|__/ \_______/
 *
 *
 *
 *     /$$$$$$$              /$$       /$$
 *    | $$__  $$            | $$      | $$
 *    | $$  \ $$ /$$   /$$ /$$$$$$   /$$$$$$    /$$$$$$  /$$$$$$$   /$$$$$$$
 *    | $$$$$$$ | $$  | $$|_  $$_/  |_  $$_/   /$$__  $$| $$__  $$ /$$_____/
 *    | $$__  $$| $$  | $$  | $$      | $$    | $$  \ $$| $$  \ $$|  $$$$$$
 *    | $$  \ $$| $$  | $$  | $$ /$$  | $$ /$$| $$  | $$| $$  | $$ \____  $$
 *    | $$$$$$$/|  $$$$$$/  |  $$$$/  |  $$$$/|  $$$$$$/| $$  | $$ /$$$$$$$/
 *    |_______/  \______/    \___/     \___/   \______/ |__/  |__/|_______/
 *
 *
 *
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * NEW FILE
 *  Create a new file
 ****************************************************************************/</span>
Digsim.prototype.newFile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Reset information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    digsim.iComp = <span class="hljs-number">0</span>;
    digsim.components.clear();
    digsim.drivers = [];
    digsim.placeholders = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; digsim.NUM_COLS; ++i) {
        digsim.placeholders[i] = [];
    }
    $(<span class="hljs-string">'#messages'</span>).html(<span class="hljs-string">''</span>);

    digsim.clearCanvas(digsim.staticContext);
    digsim.deactivateButtons();
};

<span class="hljs-comment">/*****************************************************************************
 * SUBMIT FILE
 *  Submits the hidden file upload form to the server.
 ****************************************************************************/</span>
Digsim.prototype.submitFile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    $(<span class="hljs-string">'#uploadForm'</span>).submit();
};

<span class="hljs-comment">/*****************************************************************************
 * READ FILE CONTENTS
 *  Reads the contents of the hidden iframe after the file has been submitted.
 ****************************************************************************/</span>
Digsim.prototype.readFileContents = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> contents = $(<span class="hljs-string">'#fileContents'</span>).contents().find(<span class="hljs-string">'body'</span>).text();</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>Clear the form when finished
Prevents pop up in IE because of the method=â€postâ€ of the form when refreshing the page.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (contents !== <span class="hljs-string">""</span>) {
        document.getElementById(<span class="hljs-string">"uploadForm"</span>).reset();
        document.getElementById(<span class="hljs-string">'fileContents'</span>).src = <span class="hljs-string">"about:blank"</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Display error messages</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (contents.substring(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>) === <span class="hljs-string">"Error"</span>) {
        digsim.addMessage(digsim.ERROR, <span class="hljs-string">"Error parsing file: "</span> + contents.substring(<span class="hljs-number">7</span>));
    }
    <span class="hljs-keyword">if</span> (contents === <span class="hljs-string">"file"</span>) {
        digsim.addMessage(digsim.ERROR, <span class="hljs-string">"Error parsing file: Incorrect file type. File must be of type '.json'."</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (contents === <span class="hljs-string">"size"</span>) {
        digsim.addMessage(digsim.ERROR, <span class="hljs-string">"Error parsing file: File is too large."</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (contents !== <span class="hljs-string">""</span>) {
        digsim.openFile(contents);
    }
};

<span class="hljs-comment">/*****************************************************************************
 * OPEN FILE
 *  Open a schematic into the program.
 * @param {string} contents - JSON string of the file contents.
 ****************************************************************************/</span>
Digsim.prototype.openFile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(contents)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Donâ€™t do anything if the button is disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Open'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> comps = [];
    <span class="hljs-keyword">var</span> components, c, comp, i, name, Class, id = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Parse the JSON string and validate contents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">try</span> {
       components = $.parseJSON(contents);
       digsim.validateFile(components);
    }
    <span class="hljs-keyword">catch</span> (e) {
        digsim.addMessage(digsim.ERROR, <span class="hljs-string">"Error parsing file: Data missing or incomplete."</span>);
        <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Use reflection to dynamically create Component based on name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; components.length; i++) {
        c = components[i];

        name = c.name;
        Class = window[name];
        comp = <span class="hljs-keyword">new</span> Class(c.numInputs);
        comp.init(c.row, c.col, c.rotation, c.id);</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Copy all properties of the Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $.extend(comp, c);</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Set Wire direction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE) {
            comp.dx = (comp.path.x ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);
            comp.dy = (comp.path.y ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Find the highest id so we can start iComp there</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (comp.id &gt; id)
            id = comp.id;

        comps[i] = comp;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>Reset current file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    digsim.newFile();
    digsim.iComp = id + <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Set up schematic</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; comps.length; i++) {
        comp = comps[i];
        digsim.components.add(comp);

        digsim.setPlaceholders(comp);

        <span class="hljs-keyword">if</span> (comp.type === digsim.SWITCH || comp.type === digsim.CLOCK) {
            digsim.drivers.push(comp.id);
        }

        comp.checkConnections();
    }

    digsim.drawAllComponents();
};

<span class="hljs-comment">/*****************************************************************************
 * VALIDATE FILE
 *  Validate that the contents of a file are correct.
 * @param {Array} components - Array of parsed JSON objects.
 ****************************************************************************/</span>
Digsim.prototype.validateFile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(components)</span> {</span>
    <span class="hljs-keyword">var</span> comp;</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Ensure the object is an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!$.isArray(components)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"array"</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Check that each component has the proper data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; components.length; i++) {
        comp = components[i];

        <span class="hljs-keyword">try</span> {
            digsim.validateComponent(comp);
        }
        <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-keyword">throw</span> e;
        }
    }
};

<span class="hljs-comment">/*****************************************************************************
 * VALIDATE COMPONENT
 *  Validate that the a Component has all needed properties for a save or load.
 * @param {Components} comp - Component whose properties to validate.
 * @throws An error if a property is missing.
 ****************************************************************************/</span>
Digsim.prototype.validateComponent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(comp)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.type === <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"type"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.id === <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"id"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.name === <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"name"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.numInputs === <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"numInputs"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.row === <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"row"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.col === <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"col"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.rotation === <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"rotation"</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.label === <span class="hljs-string">'undefined'</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-string">"label"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.path === <span class="hljs-string">'undefined'</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-string">"path"</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.path.x === <span class="hljs-string">'undefined'</span> || <span class="hljs-keyword">typeof</span> comp.path.y === <span class="hljs-string">'undefined'</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-string">"path.x || path.y"</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Clock</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.CLOCK) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.frequency === <span class="hljs-string">'undefined'</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-string">"frequency"</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>PROM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.PROM) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.addresses === <span class="hljs-string">'undefined'</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-string">"addresses"</span>;
    }
};

<span class="hljs-comment">/*****************************************************************************
 * SAVE FILE
 *  Save the schematic to a JSON object then call a PHP script to let the user
 *  download it to their computer.
 ****************************************************************************/</span>
Digsim.prototype.saveFile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Donâ€™t do anything if the button is disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Save'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> components = [];
    <span class="hljs-keyword">var</span> comps, comp, i;</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Create a new array that will be turned into the JSON object
Copy so we donâ€™t modify any of the existing Components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    comps = digsim.components.get();
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; comps.length; i++)  {
        components[i] = $.extend(<span class="hljs-literal">true</span>, {}, comps[i]);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Remove unneeded properties to reduce JSON string length</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; components.length; i++) {
        comp = components[i];

        <span class="hljs-keyword">delete</span> comp.numOutputs;
        <span class="hljs-keyword">delete</span> comp.dimension;
        <span class="hljs-keyword">delete</span> comp.drawStatic;
        <span class="hljs-keyword">delete</span> comp.inputs;
        <span class="hljs-keyword">delete</span> comp.outputs;
        <span class="hljs-keyword">delete</span> comp.zeroDimension;
        <span class="hljs-keyword">delete</span> comp.state;
        <span class="hljs-keyword">delete</span> comp.extraSpace;
        <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE) {
            <span class="hljs-keyword">delete</span> comp.connections;
            <span class="hljs-keyword">delete</span> comp.dx;
            <span class="hljs-keyword">delete</span> comp.dy;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>Ensure we have all needed information being saved to the file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">try</span> {
            digsim.validateComponent(comp);
        }
        <span class="hljs-keyword">catch</span> (e) {
            digsim.addMessage(digsim.ERROR, <span class="hljs-string">"Error saving file: Schematic data corrupted."</span>);
            <span class="hljs-keyword">return</span>;
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Stringify the array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    digsim.saveJson = <span class="hljs-built_in">JSON</span>.stringify(components);</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>JavaScript does not allow files to be downloaded to the users machine (FileReader API is not supported enough to use).
PHP can download files to the users machine, but the user HAS to navigate to the page (canâ€™t just use an AJAX request).
To get around this problem, we can POST the data to the PHP script and then navigate to it.</p>

            </div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>POST the data to the script to be able to send large strings to the server (GET sends the data as part of the URL string)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.ajax({
        url: <span class="hljs-string">'scripts/src/saveFile.php'</span>,
        type: <span class="hljs-string">'POST'</span>,
        data: { data: digsim.saveJson },
        success: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
            window.location = <span class="hljs-string">'scripts/src/saveFile.php'</span>;
        }
    });
};

<span class="hljs-comment">/*****************************************************************************
 * TOGGLE GRID
 *  Toggle the gird between drawing grid lines, wire dots, or no grid at all.
 ****************************************************************************/</span>
Digsim.prototype.toggleGrid = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    digsim.gridToggle = ++digsim.gridToggle % <span class="hljs-number">3</span>;
    digsim.drawGrid(digsim.gridContext);
};

<span class="hljs-comment">/*****************************************************************************
 * ZOOM
 *  Zoom in/out on the canvas.
 * @param {Event} event - Button click event with data attribute of dir of
 *                        1 (in) or -1 (out).
 ****************************************************************************/</span>
Digsim.prototype.zoom = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span>
    <span class="hljs-keyword">var</span> dir = event.data.dir;
    digsim.gridSize += digsim.GRID_ZOOM * dir;</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>Bound the zoom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.gridSize &gt; digsim.MAX_GRID_SIZE) {
        digsim.gridSize = digsim.MAX_GRID_SIZE;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (digsim.gridSize &lt; digsim.MIN_GRID_SIZE) {
        digsim.gridSize = digsim.MIN_GRID_SIZE;
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Enable the buttons for the opposite zoom</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (dir === <span class="hljs-number">1</span> &amp;&amp; $(<span class="hljs-string">'#Zoom_Out'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
            digsim.enableButton(<span class="hljs-string">'Zoom_Out'</span>);
        }
        <span class="hljs-keyword">if</span> (dir === -<span class="hljs-number">1</span> &amp;&amp; $(<span class="hljs-string">'#Zoom_In'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
            digsim.enableButton(<span class="hljs-string">'Zoom_In'</span>);
        }

        digsim.init();
        digsim.changeHitRadius();
        digsim.drawGrid(digsim.gridContext);
        digsim.drawAllComponents();</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>Disable buttons when at the min and max levels</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (digsim.gridSize === digsim.MAX_GRID_SIZE) {
            digsim.disableButton(<span class="hljs-string">'Zoom_In'</span>);
        }
        <span class="hljs-keyword">if</span> (digsim.gridSize === digsim.MIN_GRID_SIZE) {
            digsim.disableButton(<span class="hljs-string">'Zoom_Out'</span>);
        }
    }
};

<span class="hljs-comment">/*****************************************************************************
 * CHANGE NUM INPUTS
 *  Changes the number of inputs for a gate.
 * @param {Event} event - Button click event.
 ****************************************************************************/</span>
Digsim.prototype.changeNumInputs = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Donâ€™t do anything if the button is already active</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).hasClass(<span class="hljs-string">'active'</span>)) {
        <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Remove the active class from all buttons that have it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'.num-inputs .active'</span>).removeClass(<span class="hljs-string">'active'</span>);
    $(<span class="hljs-keyword">this</span>).addClass(<span class="hljs-string">'active'</span>);

    digsim.numGateInputs = $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'inputs'</span>);

    <span class="hljs-keyword">if</span> (digsim.selectedComponent &amp;&amp; digsim.selectedComponent.changeNumInputs) {
        digsim.selectedComponent.changeNumInputs(digsim.numGateInputs);
    }
};

<span class="hljs-comment">/**************************************************************************************************************
 *      /$$$$$$                        /$$                         /$$
 *     /$$__  $$                      | $$                        | $$
 *    | $$  \__/  /$$$$$$  /$$$$$$$  /$$$$$$    /$$$$$$   /$$$$$$ | $$
 *    | $$       /$$__  $$| $$__  $$|_  $$_/   /$$__  $$ /$$__  $$| $$
 *    | $$      | $$  \ $$| $$  \ $$  | $$    | $$  \__/| $$  \ $$| $$
 *    | $$    $$| $$  | $$| $$  | $$  | $$ /$$| $$      | $$  | $$| $$
 *    |  $$$$$$/|  $$$$$$/| $$  | $$  |  $$$$/| $$      |  $$$$$$/| $$
 *     \______/  \______/ |__/  |__/   \___/  |__/       \______/ |__/
 *
 *
 *
 *     /$$$$$$$              /$$       /$$
 *    | $$__  $$            | $$      | $$
 *    | $$  \ $$ /$$   /$$ /$$$$$$   /$$$$$$    /$$$$$$  /$$$$$$$   /$$$$$$$
 *    | $$$$$$$ | $$  | $$|_  $$_/  |_  $$_/   /$$__  $$| $$__  $$ /$$_____/
 *    | $$__  $$| $$  | $$  | $$      | $$    | $$  \ $$| $$  \ $$|  $$$$$$
 *    | $$  \ $$| $$  | $$  | $$ /$$  | $$ /$$| $$  | $$| $$  | $$ \____  $$
 *    | $$$$$$$/|  $$$$$$/  |  $$$$/  |  $$$$/|  $$$$$$/| $$  | $$ /$$$$$$$/
 *    |_______/  \______/    \___/     \___/   \______/ |__/  |__/|_______/
 *
 *
 *
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * DELETE
 *  Delete a component.
 ****************************************************************************/</span>
Digsim.prototype.delete = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Donâ€™t do anything if the button is disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Delete'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        <span class="hljs-keyword">return</span>;
    }

    digsim.deleteComponent(digsim.selectedComponent);
};

<span class="hljs-comment">/*****************************************************************************
 * ROTATE
 *  Rotate a Component clockwise or counter-clockwise.
 * @param {Event} event - Button click event with data attribute of dir of
 *                        90 (CW) or 270 (CCW).
 ****************************************************************************/</span>
Digsim.prototype.rotate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Donâ€™t do anything if rotation is disabled (both are always enabled or always disabled)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Rotate_CW'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> comp = digsim.selectedComponent;</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Delete placed Component placeholders</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!digsim.dragging) {
        digsim.deletePlaceholder(comp);
        comp.deleteConnections();
    }

    digsim.rotation = (comp.rotation + event.data.dir) % <span class="hljs-number">360</span>;
    comp.rotation = digsim.rotation;</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Swap Component dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    comp.dimension.row = comp.dimension.row ^ comp.dimension.col;
    comp.dimension.col = comp.dimension.row ^ comp.dimension.col;
    comp.dimension.row = comp.dimension.row ^ comp.dimension.col;

    digsim.drawAllComponents();

    <span class="hljs-keyword">if</span> (!digsim.dragging &amp;&amp; digsim.setPlaceholders(comp)) {
        digsim.drawComponent(comp, digsim.staticContext, <span class="hljs-string">'red'</span>);
        comp.checkConnections();
    }
    <span class="hljs-keyword">else</span> {
        digsim.drawComponent(comp, digsim.movingContext, <span class="hljs-string">'red'</span>);
    }
};

<span class="hljs-comment">/*****************************************************************************
 * CUT
 *  Cut a component to the clipboard.
 ****************************************************************************/</span>
Digsim.prototype.cut = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Donâ€™t do anything if the button is disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Cut'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        <span class="hljs-keyword">return</span>;
    }

    digsim.clipboard = digsim.selectedComponent;
    digsim.deleteComponent(digsim.selectedComponent);</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>Activate the paste button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Paste'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        digsim.enableButton(<span class="hljs-string">'Paste'</span>);
    }
};


<span class="hljs-comment">/*****************************************************************************
 * COPY
 *  Copy a component to the clipboard.
 ****************************************************************************/</span>
Digsim.prototype.copy = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>Donâ€™t do anything if the button is disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Copy'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        <span class="hljs-keyword">return</span>;
    }

    digsim.clipboard = digsim.selectedComponent;</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>Activate the paste button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Paste'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        digsim.enableButton(<span class="hljs-string">'Paste'</span>);
    }
 };

<span class="hljs-comment">/*****************************************************************************
 * PASTE
 *  Paste a component from the clipboard to the canvas.
 ****************************************************************************/</span>
Digsim.prototype.paste = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>Donâ€™t do anything if the button is disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ($(<span class="hljs-string">'#Paste'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        <span class="hljs-keyword">return</span>;
    }

    digsim.mode = digsim.PLACE_MODE;</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>Use reflection to dynamically create gate based on name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> name  = digsim.clipboard.name;
    <span class="hljs-keyword">var</span> Class = window[name];
    <span class="hljs-keyword">var</span> comp  = <span class="hljs-keyword">new</span> Class(digsim.clipboard.numInputs);</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Copy all properties of the Component but keep the new id</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.extend(<span class="hljs-literal">true</span>, comp, digsim.clipboard, {id: digsim.iComp});</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>Initialize the new Component at the mouse position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    comp.row = digsim.getMouseRow();
    comp.col = digsim.getMouseCol();

    digsim.dragging = <span class="hljs-literal">true</span>;
    digsim.dragOffset = {<span class="hljs-string">'row'</span>: <span class="hljs-number">0</span>, <span class="hljs-string">'col'</span>: <span class="hljs-number">0</span>};
    digsim.selectedComponent = comp;
    digsim.drawComponent(digsim.selectedComponent, digsim.movingContext);
    animate();
};

<span class="hljs-comment">/**************************************************************************************************************
 *     /$$   /$$           /$$
 *    | $$  | $$          | $$
 *    | $$  | $$  /$$$$$$ | $$  /$$$$$$   /$$$$$$   /$$$$$$
 *    | $$$$$$$$ /$$__  $$| $$ /$$__  $$ /$$__  $$ /$$__  $$
 *    | $$__  $$| $$$$$$$$| $$| $$  \ $$| $$$$$$$$| $$  \__/
 *    | $$  | $$| $$_____/| $$| $$  | $$| $$_____/| $$
 *    | $$  | $$|  $$$$$$$| $$| $$$$$$$/|  $$$$$$$| $$
 *    |__/  |__/ \_______/|__/| $$____/  \_______/|__/
 *                            | $$
 *                            | $$
 *                            |__/
 *     /$$$$$$$$                                 /$$     /$$
 *    | $$_____/                                | $$    |__/
 *    | $$       /$$   /$$ /$$$$$$$   /$$$$$$$ /$$$$$$   /$$  /$$$$$$  /$$$$$$$   /$$$$$$$
 *    | $$$$$   | $$  | $$| $$__  $$ /$$_____/|_  $$_/  | $$ /$$__  $$| $$__  $$ /$$_____/
 *    | $$__/   | $$  | $$| $$  \ $$| $$        | $$    | $$| $$  \ $$| $$  \ $$|  $$$$$$
 *    | $$      | $$  | $$| $$  | $$| $$        | $$ /$$| $$| $$  | $$| $$  | $$ \____  $$
 *    | $$      |  $$$$$$/| $$  | $$|  $$$$$$$  |  $$$$/| $$|  $$$$$$/| $$  | $$ /$$$$$$$/
 *    |__/       \______/ |__/  |__/ \_______/   \___/  |__/ \______/ |__/  |__/|_______/
 *
 *
 *
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * DECIMAL TO HEX
 *  Converts a decimal value to a hex value.
 * @param {number} dec - Decimal to convert.
 * @return {string} Hex value.
 ****************************************************************************/</span>
Digsim.prototype.dec2hex = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dec)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Number</span>(dec).toString(<span class="hljs-number">16</span>).toUpperCase();
};

<span class="hljs-comment">/*****************************************************************************
 * DECIMAL TO BINARY
 *  Converts a decimal value to a binary value.
 * @param {number} dec - Decimal to convert.
 * @param {string} Binary value.
 ****************************************************************************/</span>
Digsim.prototype.dec2bin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dec)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Number</span>(dec).toString(<span class="hljs-number">2</span>);
};

<span class="hljs-comment">/*****************************************************************************
 * PAD
 *  Pad a value with leading values.
 * @param {number}        value   - Value to pad.
 * @param {number}        length  - Length of the
 * @param {number/string} padding - Value to pad with @default '0'. If the length
 *                                  is greater than 1, will just use the first character.
 ****************************************************************************/</span>
Digsim.prototype.pad = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, length, padding)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">'undefined'</span>)
        padding = <span class="hljs-string">'0'</span>;
    <span class="hljs-keyword">else</span>
        padding += <span class="hljs-string">''</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Can only pad with single characters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (padding.length &gt; <span class="hljs-number">1</span>)
        padding = padding[<span class="hljs-number">0</span>];

    value = value + <span class="hljs-string">''</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(length - value.length + <span class="hljs-number">1</span>).join(padding) + value;
};

<span class="hljs-comment">/*****************************************************************************
 * GET MOUSE POS
 *  Return the position of the mouse.
 * @return {Object} - {x, y}.
 ****************************************************************************/</span>
Digsim.prototype.getMousePos = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> {x: digsim.mousePos.x, y: digsim.mousePos.y};
};

<span class="hljs-comment">/*****************************************************************************
 * GET ROW
 *  Return the y position as a row.
 * @param {number} y
 * @return {number}
 ****************************************************************************/</span>
Digsim.prototype.getRow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(y)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(y / digsim.gridSize);
};

<span class="hljs-comment">/*****************************************************************************
 * GET COL
 *  Return the x position as a col.
 * @param {number} x
 * @return {number}
 ****************************************************************************/</span>
Digsim.prototype.getCol = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(x / digsim.gridSize);
};

<span class="hljs-comment">/*****************************************************************************
 * GET MOUSE ROW
 *  Return the grid row of the current mouse position.
 * @return {number}
 ****************************************************************************/</span>
Digsim.prototype.getMouseRow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> digsim.getRow(digsim.mousePos.y);
};

<span class="hljs-comment">/*****************************************************************************
 * GET MOUSE COL
 *  Return the grid col of the current mouse position.
 * @return {number}
 ****************************************************************************/</span>
Digsim.prototype.getMouseCol = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> digsim.getCol(digsim.mousePos.x);
};

<span class="hljs-comment">/*****************************************************************************
 * RESET COMPONENT STATES
 *  Reset the state of all Components.
 ****************************************************************************/</span>
Digsim.prototype.resetComponentStates = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> comps = <span class="hljs-keyword">this</span>.components.get();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = comps.length; i &lt; len; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Reset the state of all Components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        comps[i].reset();
    }
};

<span class="hljs-comment">/*****************************************************************************
 * GET WIRE INDEX
 *  Returns the index of the where the user clicks inside a wire array
 *  placeholder cell.
 ****************************************************************************/</span>
Digsim.prototype.getWireIndex = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> mousePos  = <span class="hljs-keyword">this</span>.getMousePos();
    <span class="hljs-keyword">var</span> row       = <span class="hljs-keyword">this</span>.getMouseRow();
    <span class="hljs-keyword">var</span> col       = <span class="hljs-keyword">this</span>.getMouseCol();
    <span class="hljs-keyword">var</span> relX      = mousePos.x % digsim.gridSize;
    <span class="hljs-keyword">var</span> relY      = mousePos.y % digsim.gridSize;

    <span class="hljs-keyword">var</span> leftVert  = <span class="hljs-built_in">Math</span>.ceil(digsim.gridSize * (<span class="hljs-number">1</span> - digsim.hitRadius) / <span class="hljs-number">2</span>);
    <span class="hljs-keyword">var</span> topHor    = leftVert;
    <span class="hljs-keyword">var</span> rightVert = digsim.gridSize - topHor;
    <span class="hljs-keyword">var</span> bottomHor = rightVert;
    <span class="hljs-keyword">var</span> diagSep   = digsim.gridSize - relX;
    <span class="hljs-keyword">var</span> vert      = (relX &gt;= topHor) &amp;&amp; (relX &lt;= bottomHor);
    <span class="hljs-keyword">var</span> hor       = (relY &gt;= leftVert) &amp;&amp; (relY &lt;= rightVert);
    <span class="hljs-keyword">var</span> index     = -<span class="hljs-number">1</span>;
    <span class="hljs-keyword">var</span> array     = digsim.placeholders[row][col];

    <span class="hljs-keyword">if</span> (vert &amp;&amp; hor &amp;&amp; (array[<span class="hljs-number">0</span>] || array[<span class="hljs-number">2</span>]) &amp;&amp; (array[<span class="hljs-number">1</span>] || array[<span class="hljs-number">3</span>])) {</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>mid click and multiple wires
Determine grid snap for wires not connecting to other wires.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (relY &lt; relX) {  <span class="hljs-comment">// top</span>
            <span class="hljs-keyword">if</span> (relY &lt; diagSep) {  <span class="hljs-comment">// top-left</span>
                index = digsim.TL;
            }
            <span class="hljs-keyword">else</span> { <span class="hljs-comment">// top-right</span>
                index = digsim.TR;
            }
        }
        <span class="hljs-keyword">else</span> { <span class="hljs-comment">// bottom</span>
            <span class="hljs-keyword">if</span> (relY &lt; diagSep) { <span class="hljs-comment">// bottom-left</span>
                index = digsim.BL;
            }
            <span class="hljs-keyword">else</span> { <span class="hljs-comment">// bottom-right</span>
                index = digsim.BR;
            }
        }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (hor &amp;&amp; (array[<span class="hljs-number">1</span>] || array[<span class="hljs-number">3</span>]) &amp;&amp; relY &gt;= topHor &amp;&amp; relY &lt;= bottomHor) {
        <span class="hljs-keyword">if</span> (relX &lt;= digsim.gridSize / <span class="hljs-number">2</span>) {
            index = <span class="hljs-number">3</span>;
        }
        <span class="hljs-keyword">else</span> {
            index = <span class="hljs-number">1</span>;
        }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (vert &amp;&amp; relX &gt;= leftVert &amp;&amp; relX &lt;= rightVert) {
        <span class="hljs-keyword">if</span> (relY &lt;= digsim.gridSize / <span class="hljs-number">2</span>) {
            index = <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">else</span> {
            index = <span class="hljs-number">2</span>;
        }
    }

    <span class="hljs-keyword">return</span> index;
};

<span class="hljs-comment">/*****************************************************************************
 * PREP DRAGGING
 *  Prepare a Component for dragging by saving the connection locations (so that
 *  they can be used to quickly draw wires between).
 ****************************************************************************/</span>
Digsim.prototype.prepDragging = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> comp = digsim.selectedComponent;
    <span class="hljs-keyword">var</span> inputs, outputs, connections, cons, con, comps, connectedComp, index, space, k, j;</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>Get connected Components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE) {
        connections = comp.connections.get();
        cons = [<span class="hljs-string">'connections'</span>];
    }
    <span class="hljs-keyword">else</span> {
        inputs = comp.inputs.get();
        outputs = comp.outputs.get();
        cons = [<span class="hljs-string">'inputs'</span>,<span class="hljs-string">'outputs'</span>];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>Loop through each connection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (k = <span class="hljs-number">0</span>; k &lt; cons.length; k++) {
        con = cons[k];
        comps = (con === <span class="hljs-string">'inputs'</span> ? inputs : con === <span class="hljs-string">'outputs'</span> ? outputs : connections);</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>Loop through each Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; comps.length; j++) {
            connectedComp = comps[j];</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>Connection start space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (connectedComp.type === digsim.WIRE) {
                index = connectedComp.connections.getConnectionIndex(comp);</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>Get Wire Component space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (index === <span class="hljs-string">'input'</span>)
                    space = connectedComp.getComponentOutputSpace()[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">else</span>
                    space = connectedComp.getComponentInputSpace()[<span class="hljs-number">0</span>];

                connectedComp.drawStatic = <span class="hljs-literal">false</span>;
                digsim.deletePlaceholder(connectedComp);
            }
            <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Get Component space for a connection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (connectedComp.inputs.contains(comp)) {
                    index = connectedComp.inputs.getConnectionIndex(comp);
                    space = connectedComp.getInputRotation(index);
                }
                <span class="hljs-keyword">else</span> {
                    index = connectedComp.outputs.getConnectionIndex(comp);
                    space = connectedComp.getOutputRotation(index);
                }
            }
            digsim.connectionStarts[connectedComp.id] = {<span class="hljs-string">'r'</span>: space.row, <span class="hljs-string">'c'</span>: space.col};</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Connection target space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            index = comp[con].getConnectionIndex(connectedComp);
            <span class="hljs-keyword">if</span> (con === <span class="hljs-string">'inputs'</span>)
                space = comp.getInputRotation(index);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (con === <span class="hljs-string">'outputs'</span>)
                space = comp.getOutputRotation(index);
            <span class="hljs-keyword">else</span> {
                index = comp.connections.getConnectionIndex(connectedComp);

                <span class="hljs-keyword">if</span> (index === <span class="hljs-string">'input'</span>)
                    space = comp.getComponentInputSpace()[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">else</span>
                    space = comp.getComponentOutputSpace()[<span class="hljs-number">0</span>];
            }
            digsim.connectionTargets[connectedComp.id] = {<span class="hljs-string">'r'</span>: space.row - comp.row, <span class="hljs-string">'c'</span>: space.col - comp.col};
        }
    }

    comp.drawStatic = <span class="hljs-literal">false</span>;
    digsim.deletePlaceholder(comp);

    digsim.drawAllComponents();
};

<span class="hljs-comment">/*****************************************************************************
 * CHANGE HIT RADIUS
 *  Changes the hit radius so that wires will be easier to select.
 ****************************************************************************/</span>
Digsim.prototype.changeHitRadius = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.hitRadius = <span class="hljs-number">0.80</span> / (digsim.MIN_GRID_SIZE - digsim.MAX_GRID_SIZE) *
                      (digsim.gridSize - digsim.MIN_GRID_SIZE) + <span class="hljs-number">1</span>;
};

<span class="hljs-comment">/*****************************************************************************
 * DISABLE BUTTON
 *  Disable a button.
 * @param {number} id - The HTML id of the button to disable.
 ****************************************************************************/</span>
Digsim.prototype.disableButton = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span>
    $(<span class="hljs-string">'#'</span> + id).addClass(<span class="hljs-string">'disabled'</span>);
    $(<span class="hljs-string">'#'</span> + id).removeAttr(<span class="hljs-string">'href'</span>);
    $(<span class="hljs-string">'#'</span> + id).removeAttr(<span class="hljs-string">'title'</span>);
};

<span class="hljs-comment">/*****************************************************************************
 * ENABLE BUTTON
 *  Enable a button.
 * @param {number} id - The HTML id of the button to enable.
 ****************************************************************************/</span>
Digsim.prototype.enableButton = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Button titleâ€™s should not contain underscores</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> title = id.replace(<span class="hljs-string">"_"</span>, <span class="hljs-string">" "</span>);
    <span class="hljs-keyword">var</span> hotkey = digsim.HOT_KEYS[id];

    $(<span class="hljs-string">'#'</span> + id).removeClass(<span class="hljs-string">'disabled'</span>);
    $(<span class="hljs-string">'#'</span> + id).attr(<span class="hljs-string">'href'</span>, <span class="hljs-string">'#'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Set the title of the button to the format of â€˜[name] ([hot key])â€™;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'#'</span> + id).attr(<span class="hljs-string">'title'</span>, title + (hotkey ? <span class="hljs-string">" ("</span> + digsim.HOT_KEYS[id] + <span class="hljs-string">")"</span> : <span class="hljs-string">""</span>));
};

<span class="hljs-comment">/*****************************************************************************
 * DEACTIVATE BUTTONS
 *  Removes the 'active' class from all buttons, resets states of all Components
 *  after SIM_MODE, and changes mode back to DEFAULT_MODE.
 ****************************************************************************/</span>
 Digsim.prototype.deactivateButtons = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(id)</span> {</span>
    $(<span class="hljs-string">"canvas"</span>).css(<span class="hljs-string">'cursor'</span>,<span class="hljs-string">'default'</span>);
    $(<span class="hljs-string">'ul:not(.num-inputs) .active'</span>).removeClass(<span class="hljs-string">'active'</span>);
    <span class="hljs-keyword">this</span>.disableControlButtons();</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Reset all states and redraw canvas if application was in RUN_MODE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (id === <span class="hljs-string">"Run"</span> || <span class="hljs-keyword">this</span>.mode === <span class="hljs-keyword">this</span>.SIM_MODE) {
        <span class="hljs-keyword">this</span>.resetComponentStates();
    }

    <span class="hljs-keyword">this</span>.mode = <span class="hljs-keyword">this</span>.DEFAULT_MODE;
    <span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.selectedComponent = <span class="hljs-literal">undefined</span>;

    <span class="hljs-keyword">this</span>.clearCanvas(<span class="hljs-keyword">this</span>.movingContext);
    <span class="hljs-keyword">this</span>.drawAllComponents();
};

<span class="hljs-comment">/*****************************************************************************
 * DISABLE CONTROL BUTTONS
 *  Disable all Control buttons.
 ****************************************************************************/</span>
Digsim.prototype.disableControlButtons = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    digsim.disableButton(<span class="hljs-string">'Cut'</span>);
    digsim.disableButton(<span class="hljs-string">'Copy'</span>);
    digsim.disableButton(<span class="hljs-string">'Delete'</span>);
    digsim.disableButton(<span class="hljs-string">'Rotate_CCW'</span>);
    digsim.disableButton(<span class="hljs-string">'Rotate_CW'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>Disable the paste button if nothing has been copied</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!digsim.clipboard) {
        digsim.disableButton(<span class="hljs-string">'Paste'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Draw the selected component before reseting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.selectedComponent) {
        digsim.drawAllComponents();
    }
    <span class="hljs-keyword">this</span>.selectedComponent = <span class="hljs-literal">undefined</span>;
};

<span class="hljs-comment">/*****************************************************************************
 * SHOW COMPONENT MENUS
 *  Shows a menu that allows the user to change information about a Component.
 ****************************************************************************/</span>
Digsim.prototype.showComponentMenu = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.mode = <span class="hljs-keyword">this</span>.EDIT_MODE;
    <span class="hljs-keyword">var</span> comp = digsim.selectedComponent;</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Name the Edit screen with the number of inputs of a gate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> name = comp.name;
    <span class="hljs-keyword">if</span> (comp.isAGate() &amp;&amp; comp.numInputs &gt;= <span class="hljs-number">2</span>) {
        name = comp.numInputs + <span class="hljs-string">"-input "</span> + name;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Show clock frequency</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.CLOCK) {
        $(<span class="hljs-string">'#clock-freq'</span>).val(comp.frequency);
        $(<span class="hljs-string">'.clock-freq'</span>).show();
    }
    <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'.clock-freq'</span>).hide();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Show prom addresses</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.PROM) {
        <span class="hljs-keyword">var</span> table = document.getElementById(<span class="hljs-string">'prom-addresses'</span>);
        table.innerHTML = <span class="hljs-string">''</span>;

        <span class="hljs-keyword">var</span> docfrag = document.createDocumentFragment();
        <span class="hljs-keyword">var</span> tr, th, td, label, input, num;

        tr = document.createElement(<span class="hljs-string">"tr"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Headers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        th = document.createElement(<span class="hljs-string">"th"</span>);
        th.textContent = <span class="hljs-string">"Address"</span>;
        tr.appendChild(th);

        th = document.createElement(<span class="hljs-string">"th"</span>);
        th.textContent = <span class="hljs-string">"Hex"</span>;
        tr.appendChild(th);

        docfrag.appendChild(tr);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> address <span class="hljs-keyword">in</span> comp.addresses) {
            <span class="hljs-keyword">if</span> (comp.addresses.hasOwnProperty(address)) {
                tr = document.createElement(<span class="hljs-string">"tr"</span>);
                tr.id = <span class="hljs-string">"row-"</span> + address;</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Address</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                num = digsim.pad(digsim.dec2bin(address), comp.numInputs - <span class="hljs-number">1</span>);

                td = document.createElement(<span class="hljs-string">"td"</span>);
                label = document.createElement(<span class="hljs-string">"label"</span>);

                label.setAttribute(<span class="hljs-string">"for"</span>,<span class="hljs-string">"hex-"</span> + address);
                label.id = <span class="hljs-string">"address-"</span> + address;
                label.className = <span class="hljs-string">"address-value"</span>;
                label.innerHTML = num;

                td.appendChild(label);
                tr.appendChild(td);</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Hex</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                num = digsim.pad(digsim.dec2hex(comp.addresses[address]), <span class="hljs-number">2</span>);

                td = document.createElement(<span class="hljs-string">"td"</span>);
                input = document.createElement(<span class="hljs-string">"input"</span>);

                input.type = <span class="hljs-string">"text"</span>;
                input.setAttribute(<span class="hljs-string">'maxlength'</span>, <span class="hljs-number">2</span>);
                input.id = <span class="hljs-string">"hex-"</span> + address;
                input.className = <span class="hljs-string">"hex-value"</span>;
                input.value = num;

                td.appendChild(input);
                tr.appendChild(td);

                docfrag.appendChild(tr);
            }
        }
        table.appendChild(docfrag);

        $(<span class="hljs-string">'.prom-addresses'</span>).scrollTop(<span class="hljs-number">0</span>);
        $(<span class="hljs-string">'.prom-addresses'</span>).show();
    }
    <span class="hljs-keyword">else</span> {
        $(<span class="hljs-string">'.prom-addresses'</span>).hide();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Set the edit menu information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $(<span class="hljs-string">'#component-name'</span>).html(name);
    $(<span class="hljs-string">'#component-label'</span>).val(comp.label);
    $(<span class="hljs-string">'.component-menu'</span>).show();
    $(<span class="hljs-string">'#component-label'</span>).focus().select();
};

<span class="hljs-comment">/*****************************************************************************
 * HIDE COMPONENT MENU
 *  Closes the component edit menu.
 ****************************************************************************/</span>
Digsim.prototype.hideComponentMenu = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    digsim.mode = digsim.DEFAULT_MODE;
    $(<span class="hljs-string">'.component-menu'</span>).hide();
    $(<span class="hljs-string">'canvas'</span>).focus();
};

<span class="hljs-comment">/*****************************************************************************
 * ON SAVE COMPONENT EDIT
 *  Save changes to the component from the edit menu.
 ****************************************************************************/</span>
Digsim.prototype.onSaveComponentEdit = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> comp = digsim.selectedComponent;
    <span class="hljs-keyword">var</span> error = <span class="hljs-literal">false</span>;

    comp.label = $(<span class="hljs-string">'#component-label'</span>).val();</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Save the clock frequency. Default frequency is 2</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.CLOCK) {
        comp.frequency = <span class="hljs-built_in">parseInt</span>($(<span class="hljs-string">'#clock-freq'</span>).val(), <span class="hljs-number">10</span>) || <span class="hljs-number">2</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Save the prom addresses</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.PROM) {
        digsim.clearMessages();

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> address <span class="hljs-keyword">in</span> comp.addresses) {
            <span class="hljs-keyword">if</span> (comp.addresses.hasOwnProperty(address)) {
                <span class="hljs-keyword">var</span> hex = $(<span class="hljs-string">'#hex-'</span> + address).val();</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>Validate hex</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^[0-9A-F]+$/i</span>.test(hex)) {
                    hex = <span class="hljs-built_in">parseInt</span>(hex, <span class="hljs-number">16</span>);
                    comp.addresses[address] = hex;
                    $(<span class="hljs-string">'#row-'</span> + address).removeClass(<span class="hljs-string">'hex-error'</span>);
                }
                <span class="hljs-keyword">else</span> {
                    $(<span class="hljs-string">'#row-'</span> + address).addClass(<span class="hljs-string">'hex-error'</span>);
                    <span class="hljs-keyword">var</span> num = digsim.pad(digsim.dec2bin(address), comp.numInputs - <span class="hljs-number">1</span>);
                    digsim.addMessage(digsim.ERROR, <span class="hljs-string">'Invalid hex value for address '</span> + num, <span class="hljs-literal">false</span>);
                    error = <span class="hljs-literal">true</span>;
                }
            }
        }
    }

    <span class="hljs-keyword">if</span> (error)
        <span class="hljs-keyword">return</span>;

    digsim.hideComponentMenu();
    digsim.drawAllComponents();
    digsim.drawComponent(comp, digsim.staticContext, <span class="hljs-string">'red'</span>);
};

<span class="hljs-comment">/*****************************************************************************
 * ADD MESSAGE
 *  Adds error and warning messages to the message window.
 * @param {number}  type       - Type of message.
 * @param {string}  msg        - Message to display.
 * @param {boolean} deactivate - Deactivate buttons @default true.
 ****************************************************************************/</span>
Digsim.prototype.addMessage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type, msg, deactivate)</span> {</span>
    <span class="hljs-keyword">if</span> (type === digsim.ERROR) {
        $(<span class="hljs-string">'#messages'</span>).append(<span class="hljs-string">"&lt;span class='error'&gt;"</span> + msg + <span class="hljs-string">"&lt;/span&gt;&lt;br&gt;"</span>);
        $(<span class="hljs-string">"#messages"</span>).scrollTop($(<span class="hljs-string">"#messages"</span>)[<span class="hljs-number">0</span>].scrollHeight);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> deactivate === <span class="hljs-string">'undefined'</span> || deactivate)
            digsim.deactivateButtons();
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === digsim.WARNING) {
        $(<span class="hljs-string">'#messages'</span>).append(<span class="hljs-string">"&lt;span class='warning'&gt;"</span> + msg + <span class="hljs-string">"&lt;/span&gt;&lt;br&gt;"</span>);
        $(<span class="hljs-string">"#messages"</span>).scrollTop($(<span class="hljs-string">"#messages"</span>)[<span class="hljs-number">0</span>].scrollHeight);
    }
};

<span class="hljs-comment">/*****************************************************************************
 * CLEAR MESSAGES
 *  Clears the message window.
 ****************************************************************************/</span>
Digsim.prototype.clearMessages = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    $(<span class="hljs-string">'#messages'</span>).html(<span class="hljs-string">''</span>);
};

<span class="hljs-comment">/**************************************************************************************************************
 *     /$$      /$$ /$$
 *    | $$  /$ | $$|__/
 *    | $$ /$$$| $$ /$$  /$$$$$$   /$$$$$$
 *    | $$/$$ $$ $$| $$ /$$__  $$ /$$__  $$
 *    | $$$$_  $$$$| $$| $$  \__/| $$$$$$$$
 *    | $$$/ \  $$$| $$| $$      | $$_____/
 *    | $$/   \  $$| $$| $$      |  $$$$$$$
 *    |__/     \__/|__/|__/       \_______/
 *
 *
 *
 *     /$$$$$$$                        /$$     /$$
 *    | $$__  $$                      | $$    |__/
 *    | $$  \ $$  /$$$$$$  /$$   /$$ /$$$$$$   /$$ /$$$$$$$   /$$$$$$
 *    | $$$$$$$/ /$$__  $$| $$  | $$|_  $$_/  | $$| $$__  $$ /$$__  $$
 *    | $$__  $$| $$  \ $$| $$  | $$  | $$    | $$| $$  \ $$| $$  \ $$
 *    | $$  \ $$| $$  | $$| $$  | $$  | $$ /$$| $$| $$  | $$| $$  | $$
 *    | $$  | $$|  $$$$$$/|  $$$$$$/  |  $$$$/| $$| $$  | $$|  $$$$$$$
 *    |__/  |__/ \______/  \______/    \___/  |__/|__/  |__/ \____  $$
 *                                                           /$$  \ $$
 *                                                          |  $$$$$$/
 *                                                           \______/
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * ROUTE
 *  Route a path from start to target and adds placeholders too.
 *  Dijkstra pathfinding algorithm - www.zsheffield.net/dijkstra-pathfinding
 * @param {Object}  startRef   - Staring {row, col}.
 * @param {Object}  targetRef  - Ending {row, col}.
 * @param {boolean} returnPath - Return the path array.
 * @param {Wire}    obj        - Wire to update path (instead of creating a new one).
 ****************************************************************************/</span>
Digsim.prototype.route = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(startRef, targetRef, returnPath, obj)</span> {</span>
    <span class="hljs-keyword">var</span> start = {<span class="hljs-string">'c'</span>: startRef.c, <span class="hljs-string">'r'</span>: startRef.r};     <span class="hljs-comment">// JSON objects are pass by reference, and we don't want</span>
    <span class="hljs-keyword">var</span> target = {<span class="hljs-string">'c'</span>: targetRef.c, <span class="hljs-string">'r'</span>: targetRef.r};  <span class="hljs-comment">// to change the original data - so here, we make a copy...</span>
    <span class="hljs-keyword">var</span> placeholders = digsim.placeholders;</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>If click is in the same spot, weâ€™re done placing the wire.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (start.r === target.r &amp;&amp; start.c === target.c) {
        <span class="hljs-keyword">if</span> (!returnPath) {
            digsim.dragging = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Update existing wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (obj &amp;&amp; obj.type === digsim.WIRE) {
                obj.path.x = <span class="hljs-number">0</span>;
                obj.path.y = <span class="hljs-number">0</span>;
            }
        }
        <span class="hljs-keyword">return</span>;
    }

    console.assert(<span class="hljs-keyword">typeof</span> placeholders[target.r] !== <span class="hljs-string">"undefined"</span>, <span class="hljs-string">"digsim.placeholder doesn't exist"</span>);

    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> placeholders[target.r][target.c] !== <span class="hljs-string">'undefined'</span> || digsim.mode === digsim.DEFAULT_MODE ) {
        digsim.endRoute = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">else</span> {
        digsim.endRoute = <span class="hljs-literal">false</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>console.log(â€œSTART: r:â€ + start.r + â€œ c:â€ + start.c);
console.log(â€œTARGET: r:â€ + target.r + â€œ c:â€ + target.c);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-comment">/**
     * Node object
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">node</span><span class="hljs-params">(r, c, p)</span> {</span>
        <span class="hljs-keyword">this</span>.r = r || <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.c = c || <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.p = p || <span class="hljs-literal">undefined</span>;
    }

    <span class="hljs-keyword">var</span> neighbors = [];
    <span class="hljs-keyword">var</span> u;
    <span class="hljs-keyword">var</span> pathfound = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> alt;
    <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> dist = [];
    <span class="hljs-keyword">var</span> Q = [];
    <span class="hljs-keyword">var</span> prev = [];
    <span class="hljs-keyword">var</span> i;
    prev.push(<span class="hljs-keyword">new</span> node(start.r, start.c));</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Initialize all arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r = <span class="hljs-number">0</span>; r &lt; digsim.NUM_ROWS; ++r) {
        dist[r] = [];
        Q[r] = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c = <span class="hljs-number">0</span>; c &lt; digsim.NUM_COLS; ++c) {
            dist[r][c] = <span class="hljs-literal">Infinity</span>;
            Q[r][c] = placeholders[r][c]; <span class="hljs-comment">// placeholders go here</span>
        }
    }

    dist[start.r][start.c] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (!pathfound)
    {
        <span class="hljs-keyword">if</span> (index === prev.length) {
            <span class="hljs-keyword">break</span>;
        }
        u = prev[index];</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>u now contains the coordinate in Q with the
smallest distance in dist[]</p>

            </div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>If weâ€™ve reached our target, then weâ€™re done</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Q[u.r][u.c] = <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">if</span> (u.r === target.r &amp;&amp; u.c === target.c) {
            pathfound = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">break</span>;
        }

        <span class="hljs-keyword">if</span> (dist[u.r][u.c] === <span class="hljs-literal">Infinity</span>) { <span class="hljs-comment">// Nowhere to go</span>
            digsim.addMessage(digsim.WARNING, <span class="hljs-string">"[17]Unable to find valid path for autoroute"</span>);
            pathfound = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">break</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>FIND NEIGHBORS
Neighbor above</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((u.r - <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> Q[u.r - <span class="hljs-number">1</span>][u.c] === <span class="hljs-string">'undefined'</span> &amp;&amp;
                !(placeholders[u.r - <span class="hljs-number">1</span>][u.c] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &amp;&amp;
                <span class="hljs-keyword">typeof</span> placeholders[u.r - <span class="hljs-number">1</span>][u.c] === <span class="hljs-string">'undefined'</span>) {
                neighbors.push( {<span class="hljs-string">'r'</span>: u.r - <span class="hljs-number">1</span>, <span class="hljs-string">'c'</span>: u.c} );
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (placeholders[u.r - <span class="hljs-number">1</span>][u.c] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">if</span> (digsim.checkAdj(u, <span class="hljs-number">0</span>, target)) {
                    neighbors.push( {<span class="hljs-string">'r'</span>: u.r - <span class="hljs-number">1</span>, <span class="hljs-string">'c'</span>: u.c} );
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Neighbor right</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((u.c + <span class="hljs-number">1</span>) &lt; (digsim.NUM_COLS - <span class="hljs-number">1</span>)) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> Q[u.r][u.c + <span class="hljs-number">1</span>] === <span class="hljs-string">'undefined'</span> &amp;&amp;
                !(placeholders[u.r][u.c + <span class="hljs-number">1</span>] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &amp;&amp;
                 <span class="hljs-keyword">typeof</span> placeholders[u.r][u.c + <span class="hljs-number">1</span>] === <span class="hljs-string">'undefined'</span>) {
                neighbors.push( {<span class="hljs-string">'r'</span>: u.r, <span class="hljs-string">'c'</span>: u.c + <span class="hljs-number">1</span>} );
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (placeholders[u.r][u.c + <span class="hljs-number">1</span>] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">if</span> (digsim.checkAdj(u, <span class="hljs-number">1</span>, target)) {
                    neighbors.push( {<span class="hljs-string">'r'</span>: u.r, <span class="hljs-string">'c'</span>: u.c + <span class="hljs-number">1</span>} );
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>Neighbor below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((u.r + <span class="hljs-number">1</span>) &lt;= (digsim.NUM_ROWS - <span class="hljs-number">1</span>)) {
            <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">typeof</span> Q[u.r + <span class="hljs-number">1</span>][u.c] === <span class="hljs-string">'undefined'</span>) &amp;&amp;
                !(placeholders[u.r + <span class="hljs-number">1</span>][u.c] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &amp;&amp;
                (<span class="hljs-keyword">typeof</span> placeholders[u.r + <span class="hljs-number">1</span>][u.c] === <span class="hljs-string">'undefined'</span>)) {
                    neighbors.push( {<span class="hljs-string">'r'</span>: u.r + <span class="hljs-number">1</span>, <span class="hljs-string">'c'</span>: u.c} );
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (placeholders[u.r + <span class="hljs-number">1</span>][u.c] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">if</span> (digsim.checkAdj(u, <span class="hljs-number">2</span>, target)) {
                    neighbors.push( {<span class="hljs-string">'r'</span>: u.r + <span class="hljs-number">1</span>, <span class="hljs-string">'c'</span>: u.c} );
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>Neighbor left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((u.c - <span class="hljs-number">1</span>) &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> Q[u.r][u.c - <span class="hljs-number">1</span>] === <span class="hljs-string">'undefined'</span> &amp;&amp;
                !(placeholders[u.r][u.c - <span class="hljs-number">1</span>] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &amp;&amp;
                <span class="hljs-keyword">typeof</span> placeholders[u.r][u.c - <span class="hljs-number">1</span>] === <span class="hljs-string">'undefined'</span>) {
                    neighbors.push( {<span class="hljs-string">'r'</span>: u.r, <span class="hljs-string">'c'</span>: u.c - <span class="hljs-number">1</span>} );
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (placeholders[u.r][u.c - <span class="hljs-number">1</span>] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">if</span> (digsim.checkAdj(u, <span class="hljs-number">3</span>, target)) {
                    neighbors.push( {<span class="hljs-string">'r'</span>: u.r, <span class="hljs-string">'c'</span>: u.c - <span class="hljs-number">1</span>} );
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Add the right neighbor to the path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; neighbors.length; ++i) {
            alt = dist[u.r][u.c] + <span class="hljs-number">1</span>;
            <span class="hljs-keyword">if</span> (alt &lt; dist[ neighbors[i].r ][ neighbors[i].c ]) {
                dist[ neighbors[i].r ][ neighbors[i].c ] = alt;
                prev.push(<span class="hljs-keyword">new</span> node(neighbors[i].r, neighbors[i].c, u));
                <span class="hljs-keyword">if</span> (target.r === neighbors[i].r &amp;&amp; target.c === neighbors[i].c) {
                    pathfound = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        neighbors = [];
        ++index;
    }

    u = prev[prev.length - <span class="hljs-number">1</span>]; <span class="hljs-comment">// This is the target</span>
    <span class="hljs-keyword">if</span> (u.r !== target.r || u.c !== target.c) { <span class="hljs-comment">// no path</span>
        digsim.addMessage(digsim.WARNING, <span class="hljs-string">"[18]Unable to find valid path for autoroute"</span>);
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">var</span> S = [];
    <span class="hljs-keyword">while</span> (u !== <span class="hljs-literal">undefined</span>) {
        S.unshift( {<span class="hljs-string">'r'</span>: u.r, <span class="hljs-string">'c'</span>: u.c} );
        u = u.p;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Now to actually make the wires
First, create the separate paths
console.log(â€œStarting wire placement for autorouteâ€);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> path = [];
    <span class="hljs-keyword">var</span> currBranch = {<span class="hljs-string">'r'</span>:<span class="hljs-number">0</span>,<span class="hljs-string">'c'</span>:<span class="hljs-number">0</span>};
    <span class="hljs-keyword">var</span> currStart = start;
    <span class="hljs-keyword">var</span> prevDy = S[<span class="hljs-number">1</span>].r - S[<span class="hljs-number">0</span>].r;
    <span class="hljs-keyword">var</span> prevDx = S[<span class="hljs-number">1</span>].c - S[<span class="hljs-number">0</span>].c;
    <span class="hljs-keyword">var</span> validPlacement;
    <span class="hljs-keyword">var</span> wire = <span class="hljs-literal">null</span>;
    currBranch.r += prevDy;
    currBranch.c += prevDx;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>, len = S.length - <span class="hljs-number">1</span>; i &lt; len; ++i) {
        <span class="hljs-keyword">var</span> dx = S[i + <span class="hljs-number">1</span>].c - S[i].c;
        <span class="hljs-keyword">var</span> dy = S[i + <span class="hljs-number">1</span>].r - S[i].r;
        <span class="hljs-keyword">if</span> (dx !== prevDx &amp;&amp; dy !== prevDy) {
            <span class="hljs-keyword">if</span> (returnPath) {
                path.push( {<span class="hljs-string">'x'</span>:<span class="hljs-built_in">Math</span>.abs(currBranch.c + currStart.c),<span class="hljs-string">'y'</span>:<span class="hljs-built_in">Math</span>.abs(currBranch.r + currStart.r)} );
            }
            <span class="hljs-keyword">else</span> {
                wire = <span class="hljs-keyword">new</span> Wire();
                <span class="hljs-keyword">if</span> (prevDx === -<span class="hljs-number">1</span> || prevDy === -<span class="hljs-number">1</span>) {
                    wire.init(currStart.r + <span class="hljs-number">0.5</span> + currBranch.r, currStart.c + <span class="hljs-number">0.5</span> + currBranch.c, <span class="hljs-number">0</span>, digsim.iComp);
                }
                <span class="hljs-keyword">else</span> {
                    wire.init(currStart.r + <span class="hljs-number">0.5</span>, currStart.c + <span class="hljs-number">0.5</span>, <span class="hljs-number">0</span>, digsim.iComp);
                }
                wire.dx = <span class="hljs-built_in">Math</span>.abs(prevDx);
                wire.dy = <span class="hljs-built_in">Math</span>.abs(prevDy);
                wire.path = { <span class="hljs-string">'x'</span>:<span class="hljs-built_in">Math</span>.abs(currBranch.c),<span class="hljs-string">'y'</span>:<span class="hljs-built_in">Math</span>.abs(currBranch.r ) };

                validPlacement = digsim.setPlaceholders(wire, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">if</span> (validPlacement) {
                    digsim.components.add(wire);
                    digsim.iComp++;</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>Draws the wire on static context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    wire.checkConnections();
                    digsim.drawComponent(wire, digsim.staticContext);
                }
                <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>DO NOT PLACE WIRE, thereâ€™s something in the way.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    wire.path.pop();
                    digsim.dragging = <span class="hljs-literal">true</span>;
                }
            }
            currStart.r += currBranch.r;
            currStart.c += currBranch.c;
            currBranch = {<span class="hljs-string">'r'</span>:<span class="hljs-number">0</span>,<span class="hljs-string">'c'</span>:<span class="hljs-number">0</span>};
            prevDx = dx;
            prevDy = dy;
            --i;
        }
        <span class="hljs-keyword">else</span> {
            currBranch.r += prevDy;
            currBranch.c += prevDx;
            prevDx = dx;
            prevDy = dy;
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>Update an existing wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.mode === digsim.DEFAULT_MODE &amp;&amp; !returnPath &amp;&amp; obj &amp;&amp; obj.type === digsim.WIRE) {</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>Get the two points</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> point1, point2;
        <span class="hljs-keyword">if</span> (path.length) {
            point1 = {<span class="hljs-string">'x'</span>: path[path.length - <span class="hljs-number">1</span>].x, <span class="hljs-string">'y'</span>: path[path.length - <span class="hljs-number">1</span>].y};
        }
        <span class="hljs-keyword">else</span> {
            point1 = {<span class="hljs-string">'x'</span>: currStart.c, <span class="hljs-string">'y'</span>: currStart.r};
        }
        point2 = {<span class="hljs-string">'x'</span>: (currBranch.c + currStart.c), <span class="hljs-string">'y'</span>: (currBranch.r + currStart.r)};</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>Update wire coordinates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        obj.row = <span class="hljs-built_in">Math</span>.min(point1.y, point2.y) + <span class="hljs-number">0.5</span>;
        obj.col = <span class="hljs-built_in">Math</span>.min(point1.x, point2.x) + <span class="hljs-number">0.5</span>;
        obj.path = {<span class="hljs-string">'x'</span>: <span class="hljs-built_in">Math</span>.abs(point1.x - point2.x), <span class="hljs-string">'y'</span>: <span class="hljs-built_in">Math</span>.abs(point1.y - point2.y)};</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>Set the dx and dy of the new wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        obj.dx = (obj.path.x ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);
        obj.dy = (obj.path.y ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);

        validPlacement = digsim.setPlaceholders(obj, <span class="hljs-literal">true</span>);
        obj.drawStatic = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (returnPath) {
        path.push( {<span class="hljs-string">'x'</span>:<span class="hljs-built_in">Math</span>.abs(currBranch.c + currStart.c),<span class="hljs-string">'y'</span>:<span class="hljs-built_in">Math</span>.abs(currBranch.r + currStart.r)} );
        <span class="hljs-keyword">return</span> path;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>Place a new wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
        wire = <span class="hljs-keyword">new</span> Wire();
        <span class="hljs-keyword">if</span> (prevDx === -<span class="hljs-number">1</span> || prevDy === -<span class="hljs-number">1</span>) {
            wire.init(currStart.r + <span class="hljs-number">0.5</span> + currBranch.r, currStart.c + <span class="hljs-number">0.5</span> + currBranch.c, <span class="hljs-number">0</span>, digsim.iComp);
        }
        <span class="hljs-keyword">else</span> {
            wire.init(currStart.r + <span class="hljs-number">0.5</span>, currStart.c + <span class="hljs-number">0.5</span>, <span class="hljs-number">0</span>, digsim.iComp);
        }
        wire.dx = <span class="hljs-built_in">Math</span>.abs(prevDx);
        wire.dy = <span class="hljs-built_in">Math</span>.abs(prevDy);
        wire.path = { <span class="hljs-string">'x'</span>:<span class="hljs-built_in">Math</span>.abs(currBranch.c),<span class="hljs-string">'y'</span>:<span class="hljs-built_in">Math</span>.abs(currBranch.r ) };

        validPlacement = digsim.setPlaceholders(wire, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">if</span> (validPlacement) {
            digsim.components.add(wire);
            digsim.iComp++;</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>Draws the wire on static context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            wire.checkConnections();
            digsim.drawComponent(wire, digsim.staticContext);
        }
        <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>DO NOT PLACE WIRE, thereâ€™s something in the way.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            wire.path.pop();
            digsim.dragging = <span class="hljs-literal">true</span>;
        }

        <span class="hljs-keyword">if</span> (digsim.endRoute) {</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>If we attach to something at the end, donâ€™t start another wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            digsim.dragging = <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>If we cannot attach to something at the end point,
We will start a new wire where we ended the last one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            digsim.wireStart.col = target.c + <span class="hljs-number">0.5</span>;
            digsim.wireStart.row = target.r + <span class="hljs-number">0.5</span>;
            digsim.dragging = <span class="hljs-literal">true</span>;
        }
    }
};

<span class="hljs-comment">/*****************************************************************************
 * CHECK ADJACENT
 *  Used for autorouting to see if adjacent cells containing wires are valid
 *  paths.
 * @param {Node}   curr   - Current node.
 * @param {number} d      - Direction to travel.
 * @param {Node}   target - Goal node.
 ****************************************************************************/</span>
Digsim.prototype.checkAdj = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(curr, d, target)</span> {</span>
    <span class="hljs-keyword">var</span> r = curr.r;
    <span class="hljs-keyword">var</span> c = curr.c;
    <span class="hljs-keyword">var</span> t, array;
    <span class="hljs-keyword">if</span> (digsim.placeholders[r][c] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> digsim.placeholders[r][c][d] !== <span class="hljs-string">'undefined'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">switch</span> (d)
    {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>: <span class="hljs-comment">// moving up</span>
            array = digsim.placeholders[r-<span class="hljs-number">1</span>][c];
            t =    (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">0</span>] === <span class="hljs-string">'undefined'</span>) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">1</span>] !== <span class="hljs-string">'undefined'</span> &amp;&amp; digsim.components.getComponent(array[<span class="hljs-number">1</span>].ref).type === digsim.WIRE) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">2</span>] === <span class="hljs-string">'undefined'</span>) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">3</span>] !== <span class="hljs-string">'undefined'</span> &amp;&amp; digsim.components.getComponent(array[<span class="hljs-number">3</span>].ref).type === digsim.WIRE);</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>console.log(â€œ(â€œ+c+â€,â€+(r-1)+â€) is â€œ+(t?â€â€:â€not â€œ)+â€valid for current (â€œ+c+â€,â€+r+â€)â€);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                   <span class="hljs-keyword">return</span> ((r - <span class="hljs-number">1</span>) === target.r &amp;&amp; c === target.c) ? <span class="hljs-literal">true</span> : t;
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-comment">// moving right</span>
            array = digsim.placeholders[r][c+<span class="hljs-number">1</span>];
            t =    (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">0</span>] !== <span class="hljs-string">'undefined'</span> &amp;&amp; digsim.components.getComponent(array[<span class="hljs-number">0</span>].ref).type === digsim.WIRE) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">1</span>] === <span class="hljs-string">'undefined'</span>) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">2</span>] !== <span class="hljs-string">'undefined'</span> &amp;&amp; digsim.components.getComponent(array[<span class="hljs-number">2</span>].ref).type === digsim.WIRE) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">3</span>] === <span class="hljs-string">'undefined'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>console.log(â€œ(â€œ+(c+1)+â€,â€+r+â€) is â€œ+(t?â€â€:â€not â€œ)+â€valid for current (â€œ+c+â€,â€+r+â€)â€);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                   <span class="hljs-keyword">return</span> (r === target.r &amp;&amp; (c + <span class="hljs-number">1</span>) === target.c) ? <span class="hljs-literal">true</span> : t;
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-comment">// moving down</span>
            array = digsim.placeholders[r+<span class="hljs-number">1</span>][c];
            t =    (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">0</span>] === <span class="hljs-string">'undefined'</span>) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">1</span>] !== <span class="hljs-string">'undefined'</span> &amp;&amp; digsim.components.getComponent(array[<span class="hljs-number">1</span>].ref).type === digsim.WIRE) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">2</span>] === <span class="hljs-string">'undefined'</span>) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">3</span>] !== <span class="hljs-string">'undefined'</span> &amp;&amp; digsim.components.getComponent(array[<span class="hljs-number">3</span>].ref).type === digsim.WIRE);</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>console.log(â€œ(â€œ+c+â€,â€+(r+1)+â€) is â€œ+(t?â€â€:â€not â€œ)+â€valid for current (â€œ+c+â€,â€+r+â€)â€);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                   <span class="hljs-keyword">return</span> ((r + <span class="hljs-number">1</span>) === target.r &amp;&amp; c === target.c) ? <span class="hljs-literal">true</span> : t;
        <span class="hljs-keyword">default</span>: <span class="hljs-comment">// moving left</span>
            array = digsim.placeholders[r][c-<span class="hljs-number">1</span>];
            t =    (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">0</span>] !== <span class="hljs-string">'undefined'</span> &amp;&amp; digsim.components.getComponent(array[<span class="hljs-number">0</span>].ref).type === digsim.WIRE) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">1</span>] === <span class="hljs-string">'undefined'</span>) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">2</span>] !== <span class="hljs-string">'undefined'</span> &amp;&amp; digsim.components.getComponent(array[<span class="hljs-number">2</span>].ref).type === digsim.WIRE) &amp;&amp;
                   (<span class="hljs-keyword">typeof</span> array[<span class="hljs-number">3</span>] === <span class="hljs-string">'undefined'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>console.log(â€œ(â€œ+(c-1)+â€,â€+r+â€) is â€œ+(t?â€â€:â€not â€œ)+â€valid for current (â€œ+c+â€,â€+r+â€)â€);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                   <span class="hljs-keyword">return</span> (r === target.r &amp;&amp; (c - <span class="hljs-number">1</span>) === target.c) ? <span class="hljs-literal">true</span> : t;
    }
};

<span class="hljs-comment">/**************************************************************************************************************
 *      /$$$$$$            /$$                           /$$     /$$
 *     /$$__  $$          |__/                          | $$    |__/
 *    | $$  \ $$ /$$$$$$$  /$$ /$$$$$$/$$$$   /$$$$$$  /$$$$$$   /$$  /$$$$$$  /$$$$$$$
 *    | $$$$$$$$| $$__  $$| $$| $$_  $$_  $$ |____  $$|_  $$_/  | $$ /$$__  $$| $$__  $$
 *    | $$__  $$| $$  \ $$| $$| $$ \ $$ \ $$  /$$$$$$$  | $$    | $$| $$  \ $$| $$  \ $$
 *    | $$  | $$| $$  | $$| $$| $$ | $$ | $$ /$$__  $$  | $$ /$$| $$| $$  | $$| $$  | $$
 *    | $$  | $$| $$  | $$| $$| $$ | $$ | $$|  $$$$$$$  |  $$$$/| $$|  $$$$$$/| $$  | $$
 *    |__/  |__/|__/  |__/|__/|__/ |__/ |__/ \_______/   \___/  |__/ \______/ |__/  |__/
 *
 *
 *
 ***************************************************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * ANIMATE
 *  Draw the selected Component onto the Moving canvas.
 ****************************************************************************/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">animate</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>Only animate if dragging a Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.dragging === <span class="hljs-literal">false</span>) {
        <span class="hljs-keyword">return</span>;
    }

    requestAnimFrame(animate);

    <span class="hljs-keyword">var</span> context = digsim.movingContext;
    digsim.clearCanvas(context, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>Keep the Component where the user clicked on it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> row = digsim.getMouseRow();
    <span class="hljs-keyword">var</span> col = digsim.getMouseCol();
    <span class="hljs-keyword">var</span> comp = digsim.selectedComponent;</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>Only allow Wires to move either horizontal or vertical</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE &amp;&amp; comp.dy)
        comp.col = col - digsim.dragOffset.col;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE &amp;&amp; comp.dx)
        comp.row = row - digsim.dragOffset.row;
    <span class="hljs-keyword">else</span> {
        comp.col = col - digsim.dragOffset.col;
        comp.row = row - digsim.dragOffset.row;
    }

    comp.draw(context, <span class="hljs-string">'red'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>Keep Components connected by drawing Wires between them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> start, target, path, i, len2;
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> digsim.connectionStarts) {
        <span class="hljs-keyword">if</span> (digsim.connectionStarts.hasOwnProperty(i)) {
            start = digsim.connectionStarts[i];
            target = digsim.connectionTargets[i];

            target = {<span class="hljs-string">'r'</span>: comp.row + target.r, <span class="hljs-string">'c'</span>: comp.col + target.c};

            <span class="hljs-keyword">if</span> (start.r &gt;= <span class="hljs-number">0</span> &amp;&amp; target.r &gt;= <span class="hljs-number">0</span>)
                path = digsim.route(start, target, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>Draw wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (path) {
                context.beginPath();
                context.moveTo((start.c + <span class="hljs-number">0.5</span>) * digsim.gridSize, (start.r + <span class="hljs-number">0.5</span>) * digsim.gridSize);

                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len2 = path.length; i &lt; len2; ++i) {
                    context.lineTo((path[i].x + <span class="hljs-number">0.5</span>) * digsim.gridSize, (path[i].y + <span class="hljs-number">0.5</span>) * digsim.gridSize);
                }
                context.stroke();
            }
        }
    }
}

<span class="hljs-comment">/*****************************************************************************
 * ANIMATE WIRE
 *  Draw a Wire being placed onto the Moving canvas.
 ****************************************************************************/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">animateWire</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>Only animate if dragging a Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!digsim.dragging || digsim.mode !== digsim.WIRE_MODE) {
        <span class="hljs-keyword">return</span>;
    }

    requestAnimFrame(animateWire);

    <span class="hljs-keyword">var</span> context = digsim.movingContext;
    digsim.clearCanvas(context);

    <span class="hljs-keyword">var</span> row = digsim.getMouseRow();
    <span class="hljs-keyword">var</span> col = digsim.getMouseCol();</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>Draw wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    context.fillStyle   = <span class="hljs-string">'#3399FF'</span>;
    context.strokeStyle = <span class="hljs-string">'#3399FF'</span>;
    context.lineWidth   = <span class="hljs-number">2</span>;
    context.lineCap     = <span class="hljs-string">'round'</span>;

    context.beginPath();
    context.arc(digsim.wireStart.col * digsim.gridSize, digsim.wireStart.row * digsim.gridSize, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI);
    context.fill();
    context.moveTo(digsim.wireStart.col * digsim.gridSize, digsim.wireStart.row * digsim.gridSize);

    <span class="hljs-keyword">var</span> x = (col + <span class="hljs-number">0.5</span>) * digsim.gridSize;
    <span class="hljs-keyword">var</span> y = (row + <span class="hljs-number">0.5</span>) * digsim.gridSize;

    context.lineTo(x, y);
    context.stroke();
}

<span class="hljs-comment">/*****************************************************************************
 * CLOCK CYCLE
 *  Animate function for the Clock Component.
 ****************************************************************************/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cycleClock</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>Only animate when in SIM_MODE</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (digsim.mode !== digsim.SIM_MODE) {
        <span class="hljs-keyword">return</span>;
    }

    requestAnimFrame(cycleClock);
    ++digsim.clkCnt;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = digsim.drivers.length; i &lt; len; ++i) {
        <span class="hljs-keyword">var</span> driver = digsim.components.getComponent(digsim.drivers[i]);

        <span class="hljs-keyword">if</span> (driver.type === digsim.CLOCK &amp;&amp; (digsim.clkCnt % (<span class="hljs-number">60</span> / driver.frequency)) === <span class="hljs-number">0</span>) { <span class="hljs-comment">// FPS is approximately 60 Hz</span>
            digsim.passCounter = <span class="hljs-number">0</span>;
            driver.passState(!driver.state);
            digsim.drawAllComponents();
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>Reset counter to prevent number overflow</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    digsim.clkCnt %= <span class="hljs-number">60</span>;
}

<span class="hljs-comment">/*****************************************************************************
 * REQUEST ANIMATION FRAME
 *  Optimizes the 60 fps animation frame rate relative to the browser.
 ****************************************************************************/</span>
window.requestAnimFrame = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span>  window.requestAnimationFrame       ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame    ||
            window.oRequestAnimationFrame      ||
            window.msRequestAnimationFrame     ||
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback, element)</span>{</span>
                window.setTimeout(callback, <span class="hljs-number">1000</span> / <span class="hljs-number">60</span>);
            };
})();

<span class="hljs-comment">/**************************************************************************************************************
 *     /$$$$$$$            /$$
 *    | $$__  $$          | $$
 *    | $$  \ $$  /$$$$$$ | $$$$$$$  /$$   /$$  /$$$$$$
 *    | $$  | $$ /$$__  $$| $$__  $$| $$  | $$ /$$__  $$
 *    | $$  | $$| $$$$$$$$| $$  \ $$| $$  | $$| $$  \ $$
 *    | $$  | $$| $$_____/| $$  | $$| $$  | $$| $$  | $$
 *    | $$$$$$$/|  $$$$$$$| $$$$$$$/|  $$$$$$/|  $$$$$$$
 *    |_______/  \_______/|_______/  \______/  \____  $$
 *                                             /$$  \ $$
 *                                            |  $$$$$$/
 *                                             \______/
 *     /$$$$$$$$                                 /$$     /$$
 *    | $$_____/                                | $$    |__/
 *    | $$       /$$   /$$ /$$$$$$$   /$$$$$$$ /$$$$$$   /$$  /$$$$$$  /$$$$$$$   /$$$$$$$
 *    | $$$$$   | $$  | $$| $$__  $$ /$$_____/|_  $$_/  | $$ /$$__  $$| $$__  $$ /$$_____/
 *    | $$__/   | $$  | $$| $$  \ $$| $$        | $$    | $$| $$  \ $$| $$  \ $$|  $$$$$$
 *    | $$      | $$  | $$| $$  | $$| $$        | $$ /$$| $$| $$  | $$| $$  | $$ \____  $$
 *    | $$      |  $$$$$$/| $$  | $$|  $$$$$$$  |  $$$$/| $$|  $$$$$$/| $$  | $$ /$$$$$$$/
 *    |__/       \______/ |__/  |__/ \_______/   \___/  |__/ \______/ |__/  |__/|_______/
 *
 *
 *
 **************************************************************************************************************/</span>
Digsim.prototype.debug = {
    <span class="hljs-comment">/*****************************************************************************
     * SHOW PLACEHOLDERS
     *  Debug method used to see placeholder objects visually on the grid.
     ****************************************************************************/</span>
    showPlaceholders: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        digsim.clearCanvas(digsim.gridContext);
        digsim.drawGrid(digsim.gridContext);

        <span class="hljs-keyword">var</span> row = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> col = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> r, c;

        digsim.gridContext.fillStyle = <span class="hljs-string">'black'</span>;
        digsim.gridContext.font = <span class="hljs-string">"10pt Calibri"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>Output row numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (r = <span class="hljs-number">0</span>; r &lt; digsim.NUM_ROWS; r++) {
            row = r;
            digsim.gridContext.fillText(row, digsim.gridSize / <span class="hljs-number">2</span> - <span class="hljs-number">10</span>, row * digsim.gridSize + digsim.gridSize / <span class="hljs-number">2</span> + <span class="hljs-number">10</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>Output col numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (c = <span class="hljs-number">0</span>; c &lt; digsim.NUM_COLS; c++) {
            col = c;
            digsim.gridContext.fillText(col, col * digsim.gridSize + digsim.gridSize / <span class="hljs-number">2</span> - <span class="hljs-number">10</span>, digsim.gridSize / <span class="hljs-number">2</span> + <span class="hljs-number">10</span>);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>Loop through placeholders array looking for placeholders to draw</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (r = <span class="hljs-number">0</span>; r &lt; digsim.NUM_ROWS; r++) {
            <span class="hljs-keyword">for</span> (c = <span class="hljs-number">0</span>; c &lt; digsim.NUM_COLS; c++) {
                row = r;
                col = c;</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>Draw Wire placeholders</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (digsim.placeholders[row] &amp;&amp; digsim.placeholders[row][col] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> z = <span class="hljs-number">0</span>; z &lt; <span class="hljs-number">4</span>; z++) {
                        <span class="hljs-keyword">if</span> (digsim.placeholders[row][col][z]) {
                            digsim.gridContext.save();
                            digsim.gridContext.translate(col * digsim.gridSize, row * digsim.gridSize);</pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>Rotate to the proper index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            digsim.gridContext.translate(digsim.gridSize / <span class="hljs-number">2</span>, digsim.gridSize / <span class="hljs-number">2</span>);
                            digsim.gridContext.rotate((<span class="hljs-number">90</span> * z) * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180</span>);
                            digsim.gridContext.translate(-digsim.gridSize / <span class="hljs-number">2</span>, -digsim.gridSize / <span class="hljs-number">2</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>Draw a triangle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            digsim.gridContext.fillStyle = <span class="hljs-string">'orange'</span>;
                            digsim.gridContext.beginPath();
                            digsim.gridContext.moveTo(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
                            digsim.gridContext.lineTo(digsim.gridSize, <span class="hljs-number">0</span>);
                            digsim.gridContext.lineTo(digsim.gridSize / <span class="hljs-number">2</span>, digsim.gridSize / <span class="hljs-number">2</span>);
                            digsim.gridContext.closePath();
                            digsim.gridContext.stroke();
                            digsim.gridContext.fill();
                            digsim.gridContext.restore();</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>Display placeholder ref</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            digsim.gridContext.font = <span class="hljs-string">"10pt Calibri"</span>;
                            digsim.gridContext.fillStyle = <span class="hljs-string">'black'</span>;
                            digsim.gridContext.fillText(digsim.placeholders[row][col][z].ref,
                                                        col * digsim.gridSize + digsim.gridSize / <span class="hljs-number">2</span> - (z % <span class="hljs-number">2</span> * <span class="hljs-number">10</span>),
                                                        row * digsim.gridSize + digsim.gridSize / <span class="hljs-number">2</span> + (z % <span class="hljs-number">2</span> * <span class="hljs-number">10</span>));
                        }
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>Draw Component placeholder</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (digsim.placeholders[row] &amp;&amp; digsim.placeholders[row][col]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>Draw a rectangle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    digsim.gridContext.fillStyle = <span class="hljs-string">'orange'</span>;
                    digsim.gridContext.fillRect(col * digsim.gridSize + <span class="hljs-number">1</span>,
                                                row * digsim.gridSize + <span class="hljs-number">1</span>,
                                                digsim.gridSize - <span class="hljs-number">1</span>, digsim.gridSize - <span class="hljs-number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>Display placeholder ref</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    digsim.gridContext.font = <span class="hljs-string">"18pt Calibri"</span>;
                    digsim.gridContext.fillStyle = <span class="hljs-string">'black'</span>;
                    digsim.gridContext.fillText(digsim.placeholders[row][col].ref,
                                                col * digsim.gridSize + digsim.gridSize / <span class="hljs-number">2</span> - <span class="hljs-number">10</span>,
                                                row * digsim.gridSize + digsim.gridSize / <span class="hljs-number">2</span> + <span class="hljs-number">10</span>);
                }
            }
        }
    },

    <span class="hljs-comment">/*****************************************************************************
     * OUTPUT NET LIST
     *  Debug method used to output the connections of Components.
     ****************************************************************************/</span>
    outputNetList: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> comps = digsim.components.get();
        <span class="hljs-keyword">var</span> comp;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = comps.length; i &lt; len; i++) {
            comp = comps[i];
            console.log(<span class="hljs-string">"ID: "</span> + comp.id + <span class="hljs-string">"   TYPE: "</span> + comp.name);</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>Output Wire connections</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (comp.connections) {
                console.log(<span class="hljs-string">"CONNECTIONS"</span>);
                console.log(comp.connections.get());
            }

            console.log(<span class="hljs-string">"===INPUTS==="</span>);
            console.log(comp.inputs.get());
            console.log(<span class="hljs-string">"===OUTPUTS==="</span>);
            console.log(comp.outputs.get());
            console.log(<span class="hljs-string">""</span>);
        }
    }
};

<span class="hljs-comment">/**************************************************************************************************************
 *     /$$$$$$$$                       /$$
 *    |__  $$__/                      | $$
 *       | $$     /$$$$$$   /$$$$$$$ /$$$$$$
 *       | $$    /$$__  $$ /$$_____/|_  $$_/
 *       | $$   | $$$$$$$$|  $$$$$$   | $$
 *       | $$   | $$_____/ \____  $$  | $$ /$$
 *       | $$   |  $$$$$$$ /$$$$$$$/  |  $$$$/
 *       |__/    \_______/|_______/    \___/
 *
 *
 *
 *     /$$$$$$$$                                 /$$     /$$
 *    | $$_____/                                | $$    |__/
 *    | $$       /$$   /$$ /$$$$$$$   /$$$$$$$ /$$$$$$   /$$  /$$$$$$  /$$$$$$$   /$$$$$$$
 *    | $$$$$   | $$  | $$| $$__  $$ /$$_____/|_  $$_/  | $$ /$$__  $$| $$__  $$ /$$_____/
 *    | $$__/   | $$  | $$| $$  \ $$| $$        | $$    | $$| $$  \ $$| $$  \ $$|  $$$$$$
 *    | $$      | $$  | $$| $$  | $$| $$        | $$ /$$| $$| $$  | $$| $$  | $$ \____  $$
 *    | $$      |  $$$$$$/| $$  | $$|  $$$$$$$  |  $$$$/| $$|  $$$$$$/| $$  | $$ /$$$$$$$/
 *    |__/       \______/ |__/  |__/ \_______/   \___/  |__/ \______/ |__/  |__/|_______/
 *
 *
 *
 ***************************************************************************************************************/</span>

Digsim.prototype.test = {
    <span class="hljs-comment">/*****************************************************************************
     * VALIDATE SCHEMATIC
     *  Validate a schematic based on a truth table.
     * @param {string} truthTable - Truth table for the schematic.
     *                              Format:
     *                              "A B C\n
     *                               0 0 1\n
     *                               0 1 1\n
     *                               1 0 1\n
     *                               1 1 0"
     *                              Where both A and B are Drivers and C is an LED.
     ****************************************************************************/</span>
    validateSchematic: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(truthTable)</span> {</span>
        <span class="hljs-keyword">var</span> comps = digsim.components.get();
        <span class="hljs-keyword">var</span> labels = {};
        <span class="hljs-keyword">var</span> array = [];
        <span class="hljs-keyword">var</span> results = {};
        <span class="hljs-keyword">var</span> component = {};
        <span class="hljs-keyword">var</span> i, j, len, comp, rows, headers, cols, valid;

        digsim.mode = digsim.SIM_MODE;</pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>Count the number of connections, inputs, and outputs of the schematic</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        digsim.maxSchematicLoop = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, len = comps.length; j &lt; len; ++j) {
            comp = comps[j];
            comp.reset();</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>Count the number of possible pass through the current schematic could have</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE) {
                digsim.maxSchematicLoop += comp.connections.length();</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>Reset input/output connections for a Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                comp.inputs.clear(<span class="hljs-literal">false</span>);
                comp.outputs.clear(<span class="hljs-literal">false</span>);
            }
            <span class="hljs-keyword">else</span>
                digsim.maxSchematicLoop += comp.numInputs + comp.numOutputs;

            labels[comp.label] = comp.id;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>Define a safety buffer to pass through</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        digsim.maxSchematicLoop *= <span class="hljs-number">3</span>;

        rows = truthTable.split(<span class="hljs-regexp">/\r?\n/</span>);
        headers = rows[<span class="hljs-number">0</span>].split(<span class="hljs-string">' '</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>Get the Component associated with the header label</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; headers.length; i++) {
            component = digsim.components.getComponent(labels[headers[i]]);

            <span class="hljs-keyword">if</span> (component) {
                array.push(component);

                <span class="hljs-keyword">if</span> (component.isADriver()) {
                    component.traverseConnections();
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>If we donâ€™t have all the components, through an error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (headers.length !== array.length) {</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>Find each header that is missing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> found;
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; headers.length; i++) {
                found = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; array.length; j++) {
                    <span class="hljs-keyword">if</span> (headers[i] === array[j].label) {
                        found = <span class="hljs-literal">true</span>;
                    }
                }

                <span class="hljs-keyword">if</span> (!found)
                    console.warn(<span class="hljs-string">"Cannot validate schematic; No Component labeled "</span> + headers[i]);
            }

            digsim.mode = digsim.DEFAULT_MODE;
            <span class="hljs-keyword">return</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>Loop through each row of the truth table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; rows.length; i++) {
            cols = rows[i].split(<span class="hljs-string">' '</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>Reset all switches</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; array.length; j++) {
                <span class="hljs-keyword">if</span> (array[j] &amp;&amp; array[j].isADriver()) {
                    array[j].passState(<span class="hljs-number">0</span>);
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>Pass state of each column</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; cols.length; j++) {
                component = array[j];
                digsim.passCounter = <span class="hljs-number">0</span>;

                <span class="hljs-keyword">if</span> (component &amp;&amp; component.isADriver()) {
                    component.passState(<span class="hljs-built_in">parseInt</span>(cols[j], <span class="hljs-number">10</span>));
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (component &amp;&amp; component.type === digsim.LED) {
                    valid = (component.state == <span class="hljs-built_in">parseInt</span>(cols[j], <span class="hljs-number">10</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>console.warn(â€œROW â€œ + i + â€œ: â€œ +  valid);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    results[cols.join(<span class="hljs-string">", "</span>)] = valid;
                }
            }
        }

        digsim.mode = digsim.DEFAULT_MODE;
        <span class="hljs-keyword">return</span> results;
    }
};

<span class="hljs-comment">/*****************************************************************************
 * NAMESPACE
 *  Create namespace for the application. If namespace already exists, don't
 *  override it
 ****************************************************************************/</span>
<span class="hljs-keyword">var</span> digsim = digsim || <span class="hljs-keyword">new</span> Digsim();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
