<!DOCTYPE html>

<html>
<head>
  <title>component.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="component.html">
                component.js
              </a>
            
              
              <a class="source" href="componentList.html">
                componentList.js
              </a>
            
              
              <a class="source" href="digsim.html">
                digsim.js
              </a>
            
              
              <a class="source" href="and-gate.html">
                and-gate.js
              </a>
            
              
              <a class="source" href="ascii-display.html">
                ascii-display.js
              </a>
            
              
              <a class="source" href="clock.html">
                clock.js
              </a>
            
              
              <a class="source" href="dff.html">
                dff.js
              </a>
            
              
              <a class="source" href="jkff.html">
                jkff.js
              </a>
            
              
              <a class="source" href="led.html">
                led.js
              </a>
            
              
              <a class="source" href="mux.html">
                mux.js
              </a>
            
              
              <a class="source" href="nand-gate.html">
                nand-gate.js
              </a>
            
              
              <a class="source" href="nor-gate.html">
                nor-gate.js
              </a>
            
              
              <a class="source" href="not-gate.html">
                not-gate.js
              </a>
            
              
              <a class="source" href="or-gate.html">
                or-gate.js
              </a>
            
              
              <a class="source" href="prom.html">
                prom.js
              </a>
            
              
              <a class="source" href="switch.html">
                switch.js
              </a>
            
              
              <a class="source" href="wire.html">
                wire.js
              </a>
            
              
              <a class="source" href="xor-gate.html">
                xor-gate.js
              </a>
            
              
              <a class="source" href="jquery-1.8.3.min.html">
                jquery-1.8.3.min.js
              </a>
            
              
              <a class="source" href="jquery-ui-1.10.3.draggable.min.html">
                jquery-ui-1.10.3.draggable.min.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>component.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre> <span class="hljs-comment">/******************************************************************************
 * Program:
 *  component.js
 *
 * Authors:
 *  Steven Lambert
 *  Zack Sheffield
 *
 * Summary:
 *  Base class for all Component objects.
 * @abstract
 *****************************************************************************/</span>

<span class="hljs-comment">/*****************************************************************************
 * Component
 * @constructor
 ****************************************************************************/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Component</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.row        = <span class="hljs-number">0</span>;      <span class="hljs-comment">// Row of the top left corner of the Component</span>
    <span class="hljs-keyword">this</span>.col        = <span class="hljs-number">0</span>;      <span class="hljs-comment">// Col of the top left corner of the Component</span>
    <span class="hljs-keyword">this</span>.id         = <span class="hljs-number">0</span>;      <span class="hljs-comment">// Unique id</span>
    <span class="hljs-keyword">this</span>.numInputs  = <span class="hljs-number">0</span>;      <span class="hljs-comment">// Number of input connections</span>
    <span class="hljs-keyword">this</span>.numOutputs = <span class="hljs-number">0</span>;      <span class="hljs-comment">// Number of output connections</span>
    <span class="hljs-keyword">this</span>.rotation   = <span class="hljs-number">0</span>;      <span class="hljs-comment">// Rotation of Component in 90deg intervals</span>
    <span class="hljs-keyword">this</span>.state      = -<span class="hljs-number">1</span>;     <span class="hljs-comment">// State (0 or 1) of the Component; -1 means that Component has not been traversed</span>
    <span class="hljs-keyword">this</span>.type       = <span class="hljs-number">0</span>;      <span class="hljs-comment">// Unique id for the type of Component</span>
    <span class="hljs-keyword">this</span>.name       = <span class="hljs-string">""</span>;     <span class="hljs-comment">// Unique name of Component; Must match the name of the class</span>
    <span class="hljs-keyword">this</span>.label      = <span class="hljs-string">""</span>;     <span class="hljs-comment">// Label displayed for the Component</span>
    <span class="hljs-keyword">this</span>.drawStatic = <span class="hljs-literal">true</span>;   <span class="hljs-comment">// If the Component should be drawn on the static context</span>
    <span class="hljs-keyword">this</span>.extraSpace = <span class="hljs-number">0</span>;      <span class="hljs-comment">// If the Component has extra space above and below</span>
}

<span class="hljs-comment">/******************************************************************************
 * INIT
 *  Initiates a Component at a given row, col, and rotation.
 * @param {number} row - Initial row position.
 * @param {number} col - Initial col position.
 * @param {number} rot - Rotation of the Component in 90deg increments.
 * @param {number} id  - Unique id for the Component.
 *****************************************************************************/</span>
Component.prototype.init = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(row, col, rot, id)</span> {</span>
    <span class="hljs-keyword">this</span>.row        = row;
    <span class="hljs-keyword">this</span>.col        = col;
    <span class="hljs-keyword">this</span>.drawStatic = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.rotation   = rot;
    <span class="hljs-keyword">this</span>.id         = id;
    <span class="hljs-keyword">this</span>.label      = <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Wires have no designated input/output, so we just have to keep track of their connections unit we traverse it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === digsim.WIRE) {
        <span class="hljs-keyword">this</span>.connections = <span class="hljs-keyword">new</span> ComponentList(id);  <span class="hljs-comment">// Wire connections</span>
    }
    <span class="hljs-keyword">this</span>.inputs  = <span class="hljs-keyword">new</span> ComponentList(id);          <span class="hljs-comment">// Component input connections</span>
    <span class="hljs-keyword">this</span>.outputs = <span class="hljs-keyword">new</span> ComponentList(id);          <span class="hljs-comment">// Component output connections</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Save rotation 0 dimensions for wire drawing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.zeroDimension = {<span class="hljs-string">'row'</span>: <span class="hljs-keyword">this</span>.dimension.row, <span class="hljs-string">'col'</span>: <span class="hljs-keyword">this</span>.dimension.col};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Swap row/col</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (rot === <span class="hljs-number">90</span> || rot === <span class="hljs-number">270</span>) {
        <span class="hljs-keyword">this</span>.dimension.row = <span class="hljs-keyword">this</span>.dimension.row ^ <span class="hljs-keyword">this</span>.dimension.col;
        <span class="hljs-keyword">this</span>.dimension.col = <span class="hljs-keyword">this</span>.dimension.row ^ <span class="hljs-keyword">this</span>.dimension.col;
        <span class="hljs-keyword">this</span>.dimension.row = <span class="hljs-keyword">this</span>.dimension.row ^ <span class="hljs-keyword">this</span>.dimension.col;
    }
};

<span class="hljs-comment">/******************************************************************************
 * IS A GATE
 *  Return true if the Component is a gate.
 * @return {boolean}
 *****************************************************************************/</span>
Component.prototype.isAGate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

<span class="hljs-comment">/******************************************************************************
 * IS A DRIVER
 *  Return true if the Component is a driver.
 * @return {boolean}
 *****************************************************************************/</span>
Component.prototype.isADriver = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

<span class="hljs-comment">/******************************************************************************
 * RESET
 *  Reset the state of the component.
 *****************************************************************************/</span>
Component.prototype.reset = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.state = -<span class="hljs-number">1</span>;
};

<span class="hljs-comment">/******************************************************************************
 * GET INPUT ROTATION
 *  Return the row, col, and index of the input based on rotation and input index.
 * @param {number} inputIndex - Index of input.
 * @param {number} skip       - Skip a specified number of row/col.
 * @return {Object} {row, col, index}.
 *****************************************************************************/</span>
Component.prototype.getInputRotation = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(inputIndex, skip)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Skip a row/col for even input Components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    skip = (<span class="hljs-keyword">typeof</span> skip !== <span class="hljs-string">'undefined'</span> ? skip : (<span class="hljs-keyword">this</span>.numInputs % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> &amp;&amp; inputIndex &gt;= <span class="hljs-keyword">this</span>.numInputs / <span class="hljs-number">2</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>));
    <span class="hljs-keyword">var</span> row, col, index;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Get the row and col of the first wire (0), then modify by inputIndex</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">switch</span>(<span class="hljs-keyword">this</span>.rotation / <span class="hljs-number">90</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
            row = <span class="hljs-keyword">this</span>.row + inputIndex + skip;
            col = <span class="hljs-keyword">this</span>.col - <span class="hljs-number">1</span>;
            index = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
            row = <span class="hljs-keyword">this</span>.row - <span class="hljs-number">1</span>;
            col = <span class="hljs-keyword">this</span>.col + <span class="hljs-keyword">this</span>.dimension.col - <span class="hljs-number">1</span> - inputIndex - skip;
            index = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
            row = <span class="hljs-keyword">this</span>.row + <span class="hljs-keyword">this</span>.dimension.row - <span class="hljs-number">1</span> - inputIndex - skip;
            col = <span class="hljs-keyword">this</span>.col + <span class="hljs-keyword">this</span>.dimension.col;
            index = <span class="hljs-number">3</span>;
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
            row = <span class="hljs-keyword">this</span>.row + <span class="hljs-keyword">this</span>.dimension.row;
            col = <span class="hljs-keyword">this</span>.col + inputIndex + skip;
            index = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">break</span>;
    }

    <span class="hljs-keyword">return</span> {row: row, col: col, index: index};
};

<span class="hljs-comment">/******************************************************************************
 * GET OUTPUT ROTATION
 *  Return the row, col, and index of the output based on rotation and output index.
 * @param {number} outputIndex - Index of output.
 * @param {number} skip        - Skip a specified number of row/col @default 0.
 * @return {Object} {row, col, index}.
 *****************************************************************************/</span>
Component.prototype.getOutputRotation = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(outputIndex, skip)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Skip a row/col for even input Components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    skip = (<span class="hljs-keyword">typeof</span> skip !== <span class="hljs-string">'undefined'</span> ? skip : <span class="hljs-number">0</span>);
    <span class="hljs-keyword">var</span> row, col, index;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.numOutputs === <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Get the row and col of the wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.rotation / <span class="hljs-number">90</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
                row = <span class="hljs-keyword">this</span>.row + <span class="hljs-built_in">Math</span>.floor(<span class="hljs-keyword">this</span>.dimension.row / <span class="hljs-number">2</span>);
                col = <span class="hljs-keyword">this</span>.col + <span class="hljs-keyword">this</span>.dimension.col;
                index = <span class="hljs-number">3</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                row = <span class="hljs-keyword">this</span>.row + <span class="hljs-keyword">this</span>.dimension.row;
                col = <span class="hljs-keyword">this</span>.col + <span class="hljs-built_in">Math</span>.floor(<span class="hljs-keyword">this</span>.dimension.col / <span class="hljs-number">2</span>);
                index = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                row = <span class="hljs-keyword">this</span>.row + <span class="hljs-built_in">Math</span>.floor(<span class="hljs-keyword">this</span>.dimension.row / <span class="hljs-number">2</span>);
                col = <span class="hljs-keyword">this</span>.col - <span class="hljs-number">1</span>;
                index = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                row = <span class="hljs-keyword">this</span>.row - <span class="hljs-number">1</span>;
                col = <span class="hljs-keyword">this</span>.col + <span class="hljs-built_in">Math</span>.floor(<span class="hljs-keyword">this</span>.dimension.col / <span class="hljs-number">2</span>);
                index = <span class="hljs-number">2</span>;
        }
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Get the row and col of the first wire (0), then modify by outputIndex</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">switch</span>(<span class="hljs-keyword">this</span>.rotation / <span class="hljs-number">90</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
                row = <span class="hljs-keyword">this</span>.row + outputIndex + skip;
                col = <span class="hljs-keyword">this</span>.col + <span class="hljs-keyword">this</span>.dimension.col;
                index = <span class="hljs-number">3</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                row = <span class="hljs-keyword">this</span>.row + <span class="hljs-keyword">this</span>.dimension.row;
                col = <span class="hljs-keyword">this</span>.col + <span class="hljs-keyword">this</span>.dimension.col - <span class="hljs-number">1</span> - outputIndex - skip;
                index = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                row = <span class="hljs-keyword">this</span>.row + <span class="hljs-keyword">this</span>.dimension.row - <span class="hljs-number">1</span> - outputIndex - skip;
                col = <span class="hljs-keyword">this</span>.col - <span class="hljs-number">1</span>;
                index = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                row = <span class="hljs-keyword">this</span>.row - <span class="hljs-number">1</span>;
                col = <span class="hljs-keyword">this</span>.col + outputIndex + skip;
                index = <span class="hljs-number">2</span>;
                <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">return</span> {row: row, col: col, index: index};
};

<span class="hljs-comment">/******************************************************************************
 * GET COMPONENT SPACE
 *  Return every {row, col, con, index, name} that the Component fills. Helpful for setting
 *  and deleting placeholders.
 * @return {Array} array of objects of {row, col, con, index, name}. Index is
 *                 only present if space is a wire. Name is only present if space
 *                 is used for MUX or DFF.
 *****************************************************************************/</span>
Component.prototype.getComponentSpace = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> space = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Component space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r = <span class="hljs-number">0</span>; r &lt; <span class="hljs-keyword">this</span>.dimension.row; r++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c = <span class="hljs-number">0</span>; c &lt; <span class="hljs-keyword">this</span>.dimension.col; c++) {
            <span class="hljs-comment">/*****************************************************************************
             * Space
             * @param {number} row      - Row of the space
             * @param {number} col      - Column of the space
             * @param {number} index    - Index of the space if it only fills a part of a grid.
             *                            top = 0, right = 1, bottom = 2, left = 3.
             * @param {number} con      - If the space can be used for determining connections.
             * @param {number} conIndex - Which input or output wire the connection is.
             *****************************************************************************/</span>
            space.push({
                <span class="hljs-string">'row'</span>: <span class="hljs-keyword">this</span>.row + r,
                <span class="hljs-string">'col'</span>: <span class="hljs-keyword">this</span>.col + c,
                <span class="hljs-string">'con'</span>: <span class="hljs-literal">false</span>
            });
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Combine the input and output space arrays</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    space = space.concat(<span class="hljs-keyword">this</span>.getComponentInputSpace()).concat(<span class="hljs-keyword">this</span>.getComponentOutputSpace());
    space = space.concat(<span class="hljs-keyword">this</span>.getExtraComponentSpace(<span class="hljs-keyword">this</span>.extraSpace));

    <span class="hljs-keyword">return</span> space;
};

<span class="hljs-comment">/******************************************************************************
 * GET COMPONENT INPUT SPACE
 *  Return every {row, col, con, index} that the Component input fills.
 * @return {Array} array of objects of {row, col, con, index}.
 *****************************************************************************/</span>
Component.prototype.getComponentInputSpace = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> space = [];
    <span class="hljs-keyword">var</span> input;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Input space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.numInputs; ++i) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Calculate positions of connections based on rotation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        input = <span class="hljs-keyword">this</span>.getInputRotation(i);

        space.push({
            <span class="hljs-string">'row'</span>     : input.row,
            <span class="hljs-string">'col'</span>     : input.col,
            <span class="hljs-string">'index'</span>   : input.index,
            <span class="hljs-string">'con'</span>     : <span class="hljs-literal">true</span>,
            <span class="hljs-string">'conIndex'</span>: i
        });
    }

    <span class="hljs-keyword">return</span> space;
};

<span class="hljs-comment">/******************************************************************************
 * GET COMPONENT OUTPUT SPACE
 *  Return every {row, col, con, index} that the Component output fills.
 * @return {Array} array of objects of {row, col, con, index}.
 *****************************************************************************/</span>
Component.prototype.getComponentOutputSpace = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> space = [];
    <span class="hljs-keyword">var</span> output;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Output space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.numOutputs; ++i) {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Calculate positions of connections based on rotation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        output = <span class="hljs-keyword">this</span>.getOutputRotation(i);

        space.push({
            <span class="hljs-string">'row'</span>     : output.row,
            <span class="hljs-string">'col'</span>     : output.col,
            <span class="hljs-string">'index'</span>   : output.index,
            <span class="hljs-string">'con'</span>     : <span class="hljs-literal">true</span>,
            <span class="hljs-string">'conIndex'</span>: i
        });
    }

    <span class="hljs-keyword">return</span> space;
};

<span class="hljs-comment">/******************************************************************************
 * GET EXTRA COMPONENT SPACE
 *  Return the space {row, col, con, index} above and below the Component.
 * @param {number} length - How many spaces to return (top &amp; bottom or left &amp; right count as 1).
 * @return {Array} array of objects of {row, col, con, index}.
 *****************************************************************************/</span>
Component.prototype.getExtraComponentSpace = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(length)</span> {</span>
    <span class="hljs-keyword">var</span> space = [];
    <span class="hljs-keyword">var</span> col = <span class="hljs-keyword">this</span>.col, row = <span class="hljs-keyword">this</span>.row;
    <span class="hljs-keyword">var</span> index;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Get space based on rotations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> y = <span class="hljs-number">0</span>; y &lt; <span class="hljs-number">2</span>; ++y) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Component is rotated on it’s side (90 or 270)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (((<span class="hljs-keyword">this</span>.rotation) / <span class="hljs-number">90</span>) % <span class="hljs-number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Right</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (y) {
                    col = <span class="hljs-keyword">this</span>.col + <span class="hljs-keyword">this</span>.dimension.col;
                    index = <span class="hljs-number">3</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Left</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> {
                    index = <span class="hljs-number">1</span>;
                    col = <span class="hljs-keyword">this</span>.col - <span class="hljs-number">1</span>;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Component is rotated normally (0 or 180)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (y) {
                    row = <span class="hljs-keyword">this</span>.row + <span class="hljs-keyword">this</span>.dimension.row;
                    index = <span class="hljs-number">0</span>;
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Above</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">else</span> {
                    index = <span class="hljs-number">2</span>;
                    row = <span class="hljs-keyword">this</span>.row - <span class="hljs-number">1</span>;
                }
            }

            space.push({
                <span class="hljs-string">'row'</span>  : row,
                <span class="hljs-string">'col'</span>  : col,
                <span class="hljs-string">'con'</span>  : <span class="hljs-literal">false</span>,
                <span class="hljs-string">'index'</span>: index
            });
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.rotation === <span class="hljs-number">90</span> || <span class="hljs-keyword">this</span>.rotation === <span class="hljs-number">270</span>) {
            ++row;
        }
        <span class="hljs-keyword">else</span> {
            ++col;
        }
    }

    <span class="hljs-keyword">return</span> space;
};

<span class="hljs-comment">/*****************************************************************************
 * CHECK CONNECTIONS
 *  Checks input and output spaces for other Components to connect to.
 ****************************************************************************/</span>
Component.prototype.checkConnections = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

    <span class="hljs-keyword">var</span> inputSpace = <span class="hljs-keyword">this</span>.getComponentInputSpace();
    <span class="hljs-keyword">var</span> outputSpace = <span class="hljs-keyword">this</span>.getComponentOutputSpace();
    <span class="hljs-keyword">var</span> cons, con, spaces, space, grid, ph, comp, i, j, k;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Check input and output space for connections</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    cons = [<span class="hljs-string">'inputs'</span>,<span class="hljs-string">'outputs'</span>];
    <span class="hljs-keyword">for</span> (k = <span class="hljs-number">0</span>; k &lt; cons.length; k++) {
        con = cons[k];
        spaces = (con === <span class="hljs-string">'inputs'</span> ? inputSpace : outputSpace);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Loop through each space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; spaces.length; j++) {
            space = spaces[j];</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Check every index of the space for a connection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
                grid = digsim.placeholders[space.row][space.col];
                console.assert(<span class="hljs-keyword">typeof</span> grid !== <span class="hljs-string">"undefined"</span>, <span class="hljs-string">"Gage: this should not happen"</span>, digsim.placeholders, space.row, space.col);
                ph   = grid[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>There is a Component to connect to and it is not already connected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (i !== space.index &amp;&amp; ph &amp;&amp; ph.connectable &amp;&amp; !<span class="hljs-keyword">this</span>[con].contains(digsim.components.getComponent(ph.ref))) {
                    comp = digsim.components.getComponent(ph.ref);

                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === digsim.WIRE) {
                        <span class="hljs-keyword">this</span>.connections.add(comp, space.conIndex, <span class="hljs-literal">true</span>);
                    }
                    <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">this</span>[con].add(comp, space.conIndex, <span class="hljs-literal">true</span>);
                    }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Save connection to namedConnections</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (space.name) {
                        <span class="hljs-keyword">this</span>.namedConnections[space.name] = comp;
                    }
                    <span class="hljs-keyword">if</span> (ph.name) {
                        comp.namedConnections[ph.name] = <span class="hljs-keyword">this</span>;
                    }

                    console.assert(<span class="hljs-keyword">typeof</span> comp !== <span class="hljs-string">"undefined"</span>, <span class="hljs-string">"Gage: Component is undefined"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Split a Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE &amp;&amp; grid[(i+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>] &amp;&amp; comp.id === grid[(i+<span class="hljs-number">2</span>)%<span class="hljs-number">4</span>].ref)
                        comp.splitWire(space.row, space.col);
                }
            }
        }
    }
};

<span class="hljs-comment">/*****************************************************************************
 * DELETE CONNECTIONS
 *  Remove all connections of the Component.
 ****************************************************************************/</span>
Component.prototype.deleteConnections = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">this</span>.inputs.clear();
    <span class="hljs-keyword">this</span>.outputs.clear();
};

<span class="hljs-comment">/******************************************************************************
 * DRAW LABEL
 *  Draws the label for the Component.
 * @param {CanvasRenderingContext2D} context - Context to draw to.
 * @param {string}                   color   - Font color.
 *****************************************************************************/</span>
Component.prototype.drawLabel = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(context, color)</span> {</span>
    context.save();

    context.font      = <span class="hljs-string">"10pt Calibri"</span>;
    context.fillStyle = color || <span class="hljs-string">'black'</span>;
    context.textAlign = <span class="hljs-string">'center'</span>;

    <span class="hljs-keyword">var</span> x = (<span class="hljs-keyword">this</span>.dimension.col / <span class="hljs-number">2</span>) * digsim.gridSize;
    <span class="hljs-keyword">var</span> y = -<span class="hljs-number">0.25</span> * digsim.gridSize;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === digsim.SWITCH || <span class="hljs-keyword">this</span>.type === digsim.CLOCK) {
        context.textAlign = <span class="hljs-string">'right'</span>;
        x = -<span class="hljs-number">0.25</span> * digsim.gridSize;
        y = <span class="hljs-number">0.5</span> * digsim.gridSize;
    }

    context.fillText(<span class="hljs-keyword">this</span>.label, x, y);
    context.restore();
};

<span class="hljs-comment">/******************************************************************************
 * DRAW WIRES
 *  Draws Component input and output wires
 * @param {CanvasRenderingContext2D} context    - Context to draw to.
 * @param {string}                   lineColor  - Color of the wire.
 * @param {number}                   wireLength - Length of the wires.
 *****************************************************************************/</span>
Component.prototype.drawWires = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(context, lineColor, wireLength)</span> {</span>
    context.save();

    context.beginPath();
    context.fillStyle   = <span class="hljs-string">'#FFFFFF'</span>;
    context.strokeStyle = lineColor || <span class="hljs-string">'black'</span>;
    context.lineWidth   = <span class="hljs-number">2</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Set rotation and dimension back to a rotation at 0 for easy drawing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> oldRot      = <span class="hljs-keyword">this</span>.rotation;
    <span class="hljs-keyword">var</span> oldDim      = <span class="hljs-keyword">this</span>.dimension;
    <span class="hljs-keyword">this</span>.rotation   = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.dimension  = <span class="hljs-keyword">this</span>.zeroDimension;

    wireLength      = wireLength || <span class="hljs-number">1</span>;
    <span class="hljs-keyword">var</span> inputSpace  = <span class="hljs-keyword">this</span>.getComponentInputSpace();
    <span class="hljs-keyword">var</span> outputSpace = <span class="hljs-keyword">this</span>.getComponentOutputSpace();
    <span class="hljs-keyword">var</span> space, i, x, y;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Draw input wires</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; inputSpace.length; i++) {
        space = inputSpace[i];
        x = (space.col - <span class="hljs-keyword">this</span>.col + <span class="hljs-number">0.5</span>) * digsim.gridSize;
        y = (space.row - <span class="hljs-keyword">this</span>.row + <span class="hljs-number">0.5</span>) * digsim.gridSize;

        context.moveTo(x, y);
        context.lineTo(x + digsim.gridSize * wireLength, y);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Draw output wires</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; outputSpace.length; i++) {
        space = outputSpace[i];
        x = (space.col - <span class="hljs-keyword">this</span>.col + <span class="hljs-number">0.5</span>) * digsim.gridSize;
        y = (space.row - <span class="hljs-keyword">this</span>.row + <span class="hljs-number">0.5</span>) * digsim.gridSize;

        context.moveTo(x, y);
        context.lineTo(x - digsim.gridSize * wireLength, y);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Reset rotation and dimension</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.rotation = oldRot;
    <span class="hljs-keyword">this</span>.dimension = oldDim;

    context.stroke();

    context.restore();
};

<span class="hljs-comment">/******************************************************************************
 * DRAW CONNECTION DOTS
 *  Draws connection dots
 * @param {CanvasRenderingContext2D} context    - Context to draw to.
 *****************************************************************************/</span>
Component.prototype.drawConnectionDots = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(context)</span> {</span>
    context.save();</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Set rotation and dimension back to a rotation at 0 for easy drawing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> oldRot      = <span class="hljs-keyword">this</span>.rotation;
    <span class="hljs-keyword">var</span> oldDim      = <span class="hljs-keyword">this</span>.dimension;
    <span class="hljs-keyword">this</span>.rotation   = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.dimension  = <span class="hljs-keyword">this</span>.zeroDimension;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Draw connection dots</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> connectionTypes = [<span class="hljs-string">'inputs'</span>, <span class="hljs-string">'outputs'</span>, <span class="hljs-string">'connections'</span>];
    <span class="hljs-keyword">var</span> cons = [];
    <span class="hljs-keyword">var</span> i, j, conType, comp, index, space, x, y;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Input and output connection dots</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    context.beginPath();
    context.strokeStyle = <span class="hljs-string">'#000000'</span>;
    context.fillStyle   = <span class="hljs-string">'#000000'</span>;

    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; connectionTypes.length; j++) {
        conType = connectionTypes[j];

        <span class="hljs-keyword">if</span> (conType === <span class="hljs-string">'inputs'</span>)
            cons = <span class="hljs-keyword">this</span>.inputs.get();
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (conType === <span class="hljs-string">'outputs'</span>)
            cons = <span class="hljs-keyword">this</span>.outputs.get();
        <span class="hljs-keyword">else</span>
            cons = [];

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; cons.length; i++) {
            comp = cons[i];
            index = <span class="hljs-keyword">this</span>[conType].getConnectionIndex(comp);

            <span class="hljs-keyword">if</span> (conType === <span class="hljs-string">'inputs'</span>)
                space = <span class="hljs-keyword">this</span>.getInputRotation(index);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (conType === <span class="hljs-string">'outputs'</span>)
                space = <span class="hljs-keyword">this</span>.getOutputRotation(index);

            x = (space.col - <span class="hljs-keyword">this</span>.col + <span class="hljs-number">0.5</span>) * digsim.gridSize;
            y = (space.row - <span class="hljs-keyword">this</span>.row + <span class="hljs-number">0.5</span>) * digsim.gridSize;
            context.moveTo(x, y);
            context.arc(x, y, digsim.gridSize / <span class="hljs-number">10</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.PI);
        }
    }
    context.fill();
    context.stroke();</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Reset rotation and dimension</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.rotation = oldRot;
    <span class="hljs-keyword">this</span>.dimension = oldDim;

    context.restore();
};

<span class="hljs-comment">/******************************************************************************
 * PASS STATE
 *  Passes the state of the current Component to the next Component (be it a wire,
 *  gate, LED, etc).
 * @param {number} pState - State to pass to this Component.
 *****************************************************************************/</span>
Component.prototype.passState = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(pState)</span> {</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isADriver())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Cannot call function 'passState' on non-driver Component."</span>);

    <span class="hljs-keyword">var</span> compQueue = [];  <span class="hljs-comment">// List of non-traversed Components</span>
    <span class="hljs-keyword">var</span> i, len, comp, outs, input, output, index;</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Ensure that pState is an number and not anything else</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pState = pState ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.state = pState;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Add all output Components to the queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    outs = <span class="hljs-keyword">this</span>.outputs.get();
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = outs.length; i &lt; len; ++i) {
        compQueue.push(outs[i]);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Traverse the circuit path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">while</span> (compQueue.length) {
        comp = compQueue[<span class="hljs-number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Set state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (comp.isAGate()) {
            comp.computeLogic();
        }
        <span class="hljs-keyword">else</span> {
            input = comp.inputs.get()[<span class="hljs-number">0</span>];  <span class="hljs-comment">// Component can only have 1 input</span></pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Special output</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> input.state === <span class="hljs-string">'object'</span>) {
                index = input.outputs.getConnectionIndex(comp);
                comp.state = (<span class="hljs-built_in">parseInt</span>(input.state[index]) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>);
            }
            <span class="hljs-keyword">else</span> {
                comp.state = input.state;
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Prevent infinite loops in schematics</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (digsim.passCounter &gt;= digsim.maxSchematicLoop) {
            digsim.addMessage(digsim.ERROR, <span class="hljs-string">"ERROR: Schematic contains an infinite loop caused by an unstable state."</span>);
            <span class="hljs-keyword">return</span>;
        }
        digsim.passCounter++;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Add Component outputs to the queue if their state has changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        outs = comp.outputs.get();
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = outs.length; i &lt; len; i++) {
            output = outs[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Always add a gate to the queue to check if any of it’s inputs have changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (output.isAGate()) {
                compQueue.push(output);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Special output for DFF</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> comp.state === <span class="hljs-string">'object'</span>) {
                index = comp.outputs.getConnectionIndex(output);

                <span class="hljs-keyword">if</span> (output.state !== comp.state[index])
                    compQueue.push(output);
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (output.state !== comp.state)
                compQueue.push(output);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Remove the Component from the queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        compQueue.shift();
    }
};

<span class="hljs-comment">/******************************************************************************
 * TRAVERSE CONNECTIONS
 *  Called on a driver Component (Switch or Clock). Traverses the Component's
 *  connections arrays and sets any Wires connections to input and outputs. Called
 *  every time before SIM_MODE.
 * @return {boolean} True if the entire input chain was traversed without errors.
 *****************************************************************************/</span>
Component.prototype.traverseConnections = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isADriver())
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Cannot call function 'traverseConnections' on non-driver Component."</span>);

    <span class="hljs-keyword">var</span> traversedComps = <span class="hljs-keyword">new</span> ComponentList();   <span class="hljs-comment">// List of traversed Components</span>
    <span class="hljs-keyword">var</span> compQueue = [];                         <span class="hljs-comment">// Array of non-traversed Components</span>
    <span class="hljs-keyword">var</span> i, len, comp, cons, con, outs, output, input;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Add all output Components to the queue and set their input to the driver</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    outs = <span class="hljs-keyword">this</span>.outputs.get();
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = outs.length; i &lt; len; ++i) {
        compQueue.push(outs[i]);
        outs[i].inputs.add(<span class="hljs-keyword">this</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Traverse the connection queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">while</span> (compQueue.length) {
        comp = compQueue[<span class="hljs-number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Set outputs and inputs of a Wire</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (comp.type === digsim.WIRE) {
            cons = comp.connections.get();
            input = comp.inputs.get()[<span class="hljs-number">0</span>];   <span class="hljs-comment">// Wire can only have 1 input</span>

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = cons.length; i &lt; len; i++) {
                con = cons[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Only add to output if the connection isn’t the input Component or any output of the input Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (con !== input &amp;&amp; (!input.outputs.contains(con) || con.inputs.contains(comp))) {
                    comp.outputs.add(con);
                    con.inputs.add(comp);
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Error if we traverse into a driver</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (comp.isADriver()) {
            digsim.addMessage(digsim.ERROR, <span class="hljs-string">"[16]Error: Switches '"</span> + <span class="hljs-keyword">this</span>.label + <span class="hljs-string">"' and '"</span> + comp.label + <span class="hljs-string">"' are driving one wire."</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Error if we traverse into the output of a gate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (comp.isAGate()) {
            outs = comp.outputs.get();

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = outs.length; i &lt; len; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>If the output is also in the inputs we have an error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (comp.inputs.contains(outs[i])) {
                    digsim.addMessage(digsim.ERROR, <span class="hljs-string">"[17]Error: Switch '"</span> + <span class="hljs-keyword">this</span>.label + <span class="hljs-string">"' connected to the output of Gate '"</span> + comp.label + <span class="hljs-string">"."</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }

                comp.outputs.add(outs[i]);
                outs[i].inputs.add(comp);
            }
        }

        traversedComps.add(comp);</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Add only non-traversed connections to the queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        outs = comp.outputs.get();
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, len = outs.length; i &lt; len; i++) {
            output = outs[i];

            <span class="hljs-keyword">if</span> (!traversedComps.contains(output)) {
                compQueue.push(output);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Remove the Component from the queue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        compQueue.shift();
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
